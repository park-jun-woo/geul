# GEUL Entity SIDX 마스터 계획

**버전**: v1.1
**작성일**: 2026-02-01
**상태**: Phase 2.5 완료, 추가 최적화 검토 필요

---

## 요약

GEUL Entity SIDX 64비트 인코딩 파이프라인의 최종 실행 계획입니다.
4명의 전문가(Architect, Analyst, Builder, Ontologist)가 각자 검토한 결과를 통합했습니다.

### 현재 상태 (Updated)

| Stage | 상태 | 완료율 | 결과 |
|-------|------|--------|------|
| Stage 1: 속성 추출 | 완료 | 100% | 63개 타입 분석 |
| Stage 2: 의존성 탐지 | 완료 | 100% (5개) | 298개 종속 관계 |
| Stage 3: 비트 할당 | 완료 | 100% (5개) | **[요최적화]** |
| Stage 4: 코드북 생성 | 완료 | 100% (5개) | 18,204개 코드북 |
| Stage 5: 검증 | 완료 | 33% 통과 | **[요검토]** |

### Phase 2 결과 요약

| 테스트 | 결과 | 평가 |
|--------|------|------|
| 충돌률 | 0/5 (6.56~33.18%) | **FAIL** - 목표 대비 6~33배 초과 |
| 추상표현 SIMD | 0/9 (0~48% 정밀도) | **FAIL** - 마스크 로직 오류 |
| 인코딩 일관성 | 3/5 (89~100%) | PARTIAL - 다중값 처리 문제 |
| 열화 테스트 | 5/5 (100%) | **PASS** - 핵심 원칙 검증 완료 |

---

## 핵심 발견사항 (Phase 2)

### 긍정적 발견

1. **우아한 열화(Graceful Degradation) 작동 확인**
   - 모든 5개 타입에서 비트 마스킹 시 상위 개념으로 정상 수렴
   - GEUL 설계의 핵심 원칙 검증 완료

2. **코드북 기반 결정론적 인코딩 작동**
   - 동일 입력 → 동일 출력 (일부 다중값 속성 제외)
   - hash() 대체 성공

3. **계층적 코드북 생성 성공**
   - 부모 속성별 별도 코드 테이블 정상 생성
   - 예: 직업=researcher일 때 국가 코드 vs 직업=politician일 때 국가 코드

### 부정적 발견

1. **충돌률 과다** - Stage 3 비트 할당 최적화 필요
2. **SIMD 마스크 정밀도 저하** - 코드북 미등록 값 처리 개선 필요
3. **다중값 속성 비결정성** - 정렬된 첫 번째 값 사용으로 변경 필요

---

## Phase 2.5: 최적화 (신규 추가)

### 목표

충돌률을 10% 이하로 개선하고, SIMD 정밀도를 70% 이상으로 향상

### 작업 목록

#### OPT-1: Stage 3 비트 할당 개선 (Architect/Analyst)

```
현재: 커버리지 순 → 엔트로피(구별력) 무시
개선: coverage × entropy × (1/cardinality) 가중치 적용
```

**구체적 변경:**
- `stage3_allocate.py`의 `calculate_field_priority()` 수정
- 고엔트로피 속성에 더 많은 비트 할당

#### OPT-2: Stage 5-B 마스크 로직 수정 (Builder)

```python
# 현재: 코드북에 없는 값 → code=0 → 모든 개체 매치
# 개선: 코드북에 없는 값 → 해당 필드 마스크 제외
if value not in codebook:
    # 해당 필드는 마스크에서 제외
    continue
```

#### OPT-3: 다중값 속성 정렬 (Builder)

```python
# 현재: 첫 번째 반환 값 사용 (DB 순서 의존)
# 개선: 값을 정렬 후 첫 번째 사용
values = sorted(entity_values.get(prop_id, []))
value = values[0] if values else None
```

#### OPT-4: 코드북 커버리지 확대 (Builder)

- 샘플 크기 증가: 5,000 → 20,000
- Unknown(code=0) 비율 모니터링 추가

---

## 수정된 실행 계획

### Phase 1: 준비 ✅ (완료)

- [x] Stage 2 스크립트 수정 (외부 ID 필터링)
- [x] Stage 3 수정 (hash → codebook)
- [x] Stage 5-B 구현 (추상 표현 테스트)

### Phase 2: 파일럿 실행 ✅ (완료)

- [x] 5개 타입 전체 파이프라인 실행
- [x] 결과 분석 및 보고서 생성

### Phase 2.5: 최적화 (신규, 진행 필요)

| 작업 | 담당 | 상태 |
|------|------|------|
| OPT-1: 비트 할당 개선 | Architect/Analyst | 대기 |
| OPT-2: 마스크 로직 수정 | Builder | 대기 |
| OPT-3: 다중값 정렬 | Builder | 대기 |
| OPT-4: 코드북 확대 | Builder | 대기 |

### Phase 3: 재검증

- [ ] Stage 3~5 재실행
- [ ] 목표 달성 여부 확인 (충돌률 <10%, SIMD 정밀도 >70%)

### Phase 4: 확장 실행

- [ ] 나머지 타입으로 확장 (사용자 승인 시)

---

## 사용자 결정 필요 항목 (Updated)

### [DECISION-6] Phase 2.5 진행 여부 (신규)

**질문**: 최적화 작업을 진행할 것인가?

| 옵션 | 설명 |
|------|------|
| **A (권장)** | OPT-1~4 순차 진행 후 재검증 |
| B | 현재 결과로 확장 진행 (충돌률 감수) |
| C | 근본적 재설계 (Stage 2부터 다시) |

---

## 블로커 및 해결 방안 (Updated)

### P0 (해결 완료)

| ID | 문제 | 상태 |
|----|------|------|
| B-001 | Stage 3: hash() 기반 인코딩 | ✅ 해결됨 |
| B-002 | Stage 5-B: 추상 표현 테스트 미구현 | ✅ 해결됨 |

### P1 (신규 발견)

| ID | 문제 | 해결 방안 |
|----|------|-----------|
| B-007 | 충돌률 과다 (6~33%) | OPT-1: 비트 할당 개선 |
| B-008 | SIMD 정밀도 저하 | OPT-2: 마스크 로직 수정 |
| B-009 | 다중값 비결정성 | OPT-3: 정렬 처리 |

### P2 (유지)

| ID | 문제 | 해결 방안 |
|----|------|-----------|
| B-003 | 양자화 규칙 미연동 | Phase 4에서 처리 |
| B-005 | 공통 모듈 미추출 | Phase 4에서 처리 |

---

## 산출물 목록 (Updated)

### 완료된 산출물

| 파일 | 설명 | 상태 |
|------|------|------|
| output1/stage1_report.md | 속성 추출 보고서 | ✅ |
| output1/stage2_report.md | 의존성 탐지 보고서 | ✅ |
| output1/stage3_report.md | 비트 할당 보고서 | ✅ |
| output1/stage4_report.md | 코드북 생성 보고서 | ✅ |
| output1/stage5_report.md | 검증 보고서 | ✅ |
| output1/codebooks/*.md | 타입별 코드북 (5개) | ✅ |

### 대기 중 산출물

| 파일 | 설명 |
|------|------|
| output/entity_sidx_schema_final.json | 최종 스키마 |
| output/SIDX_SPEC.md | 최종 스펙 문서 |

---

## 승인 체크리스트

**Phase 1 승인일**: 2026-02-01

- [x] **[DECISION-1]** 파이프라인 범위: **10개 타입 (A)** ✓
- [x] **[DECISION-2]** 외부 ID 필터링: **제외 (A)** ✓
- [x] **[DECISION-3]** 코드북 언어: **영한 병기 (B)** ✓
- [x] **[DECISION-4]** Stage 5-B 범위: **3개 케이스 (A)** ✓
- [x] **[DECISION-5]** 누락 타입: **통합 (B)** ✓
- [ ] **[DECISION-6]** Phase 2.5 진행 여부: **대기 중**

---

*Updated by GEUL Entity Team after Phase 2 completion*
*Date: 2026-02-01*
