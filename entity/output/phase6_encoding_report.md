# GEUL Entity SIDX Phase 6 인코딩 결과 보고서

**생성일**: 2026-02-02
**작성자**: Claude Opus 4.5

---

## 1. 개요

GEUL Entity Node의 64비트 SIDX 구조에 대한 속성 인코딩 작업 결과를 보고합니다.

### SIDX 구조
```
┌─────────┬──────┬────────────┬────────────────────────────────────────────────┐
│ Prefix  │ Mode │ EntityType │                   Attributes                   │
│ (7bit)  │(3bit)│   (6bit)   │                    (48bit)                     │
├─────────┼──────┼────────────┼────────────────────────────────────────────────┤
│0b0001001│ 000  │   XXXXXX   │ 타입별 완전 독립 스키마                         │
└─────────┴──────┴────────────┴────────────────────────────────────────────────┘
```

---

## 2. 전체 현황

| 항목 | 수치 |
|------|------|
| **총 개체 수** | 108,878,520 |
| **SIDX 인코딩 완료** | 108,878,520 (100%) |
| **속성 인코딩 완료** | 17,442,999 (16.0%) |

---

## 3. 타입별 속성 인코딩 현황

| Type | 타입명 | 개체 수 | attrs > 0 | 비율 | 상태 |
|------|--------|---------|-----------|------|------|
| 00 | Human | 12,553,670 | 12,182,686 | **97.0%** | ✅ 완료 |
| 01 | Taxon | 3,904,250 | 3,531,305 | **90.5%** | ✅ 완료 |
| 02 | Location | 1,225,857 | 0 | 0.0% | 미정의 |
| 03 | Organization | 1,010,739 | 6 | 0.0% | 미정의 |
| 04 | Event | 153,636 | 0 | 0.0% | 미정의 |
| 05 | CreativeWork | 661,560 | 0 | 0.0% | 미정의 |
| 06 | Building | 29,699 | 0 | 0.0% | 미정의 |
| 07 | Vehicle | 66,791 | 0 | 0.0% | 미정의 |
| 08 | Chemical | 1,278,837 | 0 | 0.0% | 미정의 |
| 09 | Food | 148,455 | 0 | 0.0% | 미정의 |
| 12 | Star | 4,843,949 | 1,729,008 | **35.7%** | ✅ 완료 |
| 13 | Planet | 2,120,383 | 0 | 0.0% | 미정의 |
| 31 | Artifact | 710,344 | 24,478 | 3.5% | 부분 |
| 49 | Misc | 48,063,031 | 9,801 | 0.0% | 미정의 |
| 63 | Unknown | 19,678,178 | 0 | 0.0% | 미정의 |
| 기타 | - | 12,428,141 | 5,701 | 0.0% | 미정의 |

---

## 4. Human (Type 0x00) 상세 분석

### 4.1 비트 할당
```
Bits 47-38: (reserved)
Bits 37-32: language (6bit) - 64개 언어
Bits 31-29: (reserved)
Bits 28-27: gender (2bit) - 4가지
Bits 26-23: era (4bit) - 16개 시대
Bits 22-19: (reserved)
Bits 18-11: country (8bit) - 256개 국가
Bits 10-5:  occupation (6bit) - 64개 직업
Bits 4-0:   (reserved)
```

### 4.2 Gender 분포
| 코드 | 성별 | 개체 수 | 비율 |
|------|------|---------|------|
| 1 | Male | 7,451,567 | 59.36% |
| 2 | Female | 2,687,937 | 21.41% |
| 0 | Unknown | 2,414,064 | 19.23% |
| 3 | Other | 102 | 0.00% |

### 4.3 Era 분포
| 코드 | 시대 | 개체 수 | 비율 |
|------|------|---------|------|
| 0 | 고대 (BC) | 0 | - |
| 1 | 고대 (0-500) | 9,406 | 0.13% |
| 2 | 중세 초기 (500-1000) | 22,838 | 0.32% |
| 3 | 중세 (1000-1500) | 96,061 | 1.35% |
| 4 | 근세 (1500-1700) | 240,421 | 3.37% |
| 5 | 18세기 (1700-1800) | 329,302 | 4.61% |
| 6 | 19세기 전반 (1800-1850) | 432,295 | 6.06% |
| 7 | 19세기 후반 (1850-1900) | 1,010,551 | 14.16% |
| 8 | 20세기 전반 (1900-1950) | 1,951,309 | 27.34% |
| 9 | 1950-1970 | 1,258,081 | 17.63% |
| 10 | 1970-1990 | 1,186,655 | 16.63% |
| 11 | 1990s | 403,532 | 5.65% |
| 12 | 2000s | 190,247 | 2.67% |
| 13 | 2010s | 6,151 | 0.09% |
| 14 | 2020s+ | 346 | 0.00% |

### 4.4 Country Top 15
| 코드 | 개체 수 | 비율 |
|------|---------|------|
| 1 | 604,908 | 11.48% |
| 2 | 365,549 | 6.94% |
| 3 | 311,111 | 5.90% |
| 10 | 247,174 | 4.69% |
| 4 | 215,204 | 4.08% |
| 7 | 162,086 | 3.08% |
| 8 | 137,697 | 2.61% |
| 33 | 123,951 | 2.35% |
| 17 | 120,070 | 2.28% |
| 13 | 111,414 | 2.11% |
| 9 | 110,962 | 2.11% |
| 24 | 106,448 | 2.02% |
| 11 | 104,045 | 1.97% |
| 39 | 102,400 | 1.94% |
| 19 | 91,154 | 1.73% |

### 4.5 Occupation Top 15
| 코드 | 개체 수 | 비율 |
|------|---------|------|
| 1 | 2,062,799 | 29.63% |
| 2 | 800,076 | 11.49% |
| 4 | 374,004 | 5.37% |
| 5 | 324,839 | 4.67% |
| 3 | 268,987 | 3.86% |
| 7 | 226,819 | 3.26% |
| 8 | 191,209 | 2.75% |
| 6 | 151,888 | 2.18% |
| 9 | 131,741 | 1.89% |
| 12 | 94,060 | 1.35% |
| 11 | 93,842 | 1.35% |
| 14 | 92,042 | 1.32% |
| 13 | 91,601 | 1.32% |
| 15 | 89,235 | 1.28% |
| 20 | 81,373 | 1.17% |

---

## 5. Taxon (Type 0x01) 상세 분석

### 5.1 비트 할당
```
Bits 47-32: (reserved)
Bits 31-29: conservation_status (3bit) - IUCN 등급
Bits 28-26: rank (3bit) - 분류 계급
Bits 25-0:  (reserved)
```

### 5.2 Rank 분포
| 코드 | 계급 | 개체 수 | 비율 |
|------|------|---------|------|
| 1 | species | 3,235,016 | 91.61% |
| 2 | genus | 268,272 | 7.60% |
| 3 | family | 21,223 | 0.60% |
| 4 | order | 3,503 | 0.10% |
| 5 | class | 983 | 0.03% |
| 6 | phylum | 268 | 0.01% |
| 7 | kingdom | 38 | 0.00% |
| 0 | unknown | 2,002 | 0.06% |

### 5.3 Conservation Status 분포
| 코드 | 상태 | 개체 수 | 비율 |
|------|------|---------|------|
| 0 | (없음) | 3,416,451 | 96.75% |
| 1 | LC (Least Concern) | 78,352 | 2.22% |
| 2 | NT (Near Threatened) | 8,978 | 0.25% |
| 3 | VU (Vulnerable) | 17,063 | 0.48% |
| 5 | CR (Critically Endangered) | 9,507 | 0.27% |
| 6 | EW (Extinct in Wild) | 90 | 0.00% |
| 7 | EX (Extinct) | 864 | 0.02% |

---

## 6. Star (Type 0x0C) 상세 분석

### 6.1 비트 할당
```
Bits 47-7: (reserved)
Bits 6-0:  constellation (7bit) - 88개 별자리
```

### 6.2 Constellation Top 10
| 코드 | 개체 수 | 비율 |
|------|---------|------|
| 60 | 150,062 | 8.68% |
| 8 | 102,492 | 5.93% |
| 81 | 97,533 | 5.64% |
| 34 | 93,157 | 5.39% |
| 35 | 90,185 | 5.22% |
| 83 | 90,033 | 5.21% |
| 65 | 87,310 | 5.05% |
| 62 | 73,794 | 4.27% |
| 24 | 68,805 | 3.98% |
| 4 | 65,460 | 3.79% |

### 6.3 참고
- DB 내 고유 constellation QID: 90개
- 코드북 등록: 87개
- 인코딩 대상 (P59 값 있음): 1,729,008개 (35.7%)

---

## 7. 발견 및 수정한 버그

### 7.1 P569 JSON 파싱 버그
- **문제**: 생년(P569) 데이터가 JSON 형식(`{"time":"+1969-07-15T00:00:00Z",...}`)으로 저장
- **증상**: Era 값이 모두 0으로 인코딩됨
- **해결**: `sidx_fix_era.py` 스크립트로 JSON 파싱 후 재인코딩

### 7.2 Star 코드북 QID 누락
- **문제**: constellation 코드북에 QID 매핑 없음
- **증상**: Star 인코딩 시 업데이트 0건
- **해결**: `codebooks_full.json`에 87개 constellation QID 추가

---

## 8. 생성된 파일

| 파일 | 설명 |
|------|------|
| `scripts/sidx_encode_attrs.py` | 속성 인코딩 메인 스크립트 |
| `scripts/sidx_fix_era.py` | Human Era 수정 스크립트 |
| `references/codebooks_full.json` | 전체 코드북 (constellation QID 포함) |

---

## 9. 샘플 SIDX 확인

### Human
```
Q1782277:  0x1200000308001840  (era=8, 1906년생 → 20C전반)
Q2851697:  0x1200000110000be0  (era=7, 1856년생 → 19C후반)
```

### Taxon
```
Q100255685: 0x1201000008000000  (rank=2/genus)
Q1002569:   0x1201000024000000  (rank=1/species, conservation=1/LC)
```

### Star
```
Q89272931: 0x120C000000000003  (constellation=3)
Q89272932: 0x120C000000000006  (constellation=6)
```

---

## 10. 향후 작업

1. **나머지 타입 스키마 정의**: Location, Organization, Event, CreativeWork 등
2. **코드북 검증**: Country, Occupation 코드의 실제 QID 매핑 검증
3. **충돌률 측정**: 동일 SIDX를 가진 개체 비율 분석
4. **SIMD 쿼리 테스트**: 비트 마스크 기반 범위 검색 성능 테스트

---

## 11. [CRITICAL] 타입 분류 문제

### 11.1 문제 규모

| 타입 | 개체 수 | 비율 | 상태 |
|------|---------|------|------|
| Type 49 (Misc) | 48,063,031 | 44.1% | ⚠️ P31 있지만 매핑 실패 |
| Type 63 (Unknown) | 19,678,179 | 18.1% | ❌ 분류 완전 실패 |
| **합계** | **67,741,210** | **62.2%** | **분류 미완성** |

### 11.2 원인 분석

**1. primary_mapping 누락된 중요 타입:**
- `Q6256` (country) - 미국, 독일 등 모든 국가가 Unknown
- `Q3624078` (sovereign state) - 주권국가 미매핑
- `Q5864` (G-type star) - 태양 등 별 하위타입 미매핑
- `Q55983715` (organisms by common name) - 개, 고양이 등 미매핑

**2. P279 계층 탐색 미작동:**
```
Q5864 (G-type star) --P279--> Q523 (star)  [2단계]
                              ↑ primary_mapping에 있음
하지만 태양(Q525)이 Unknown(0x3F)으로 분류됨
```

**3. 실제 사례:**
| Entity | P31 값 | 기대 타입 | 실제 결과 |
|--------|--------|-----------|-----------|
| Q144 (dog) | Q55983715 | Taxon | Unknown (0x3F) |
| Q30 (USA) | Q6256 | Location | Unknown (0x3F) |
| Q183 (Germany) | Q6256 | Location | Unknown (0x3F) |
| Q525 (Sun) | Q5864 | Star | Unknown (0x3F) |

### 11.3 해결 방안

1. **primary_mapping 확장**
   - Country (Q6256) → Location 계열 타입 추가
   - Sovereign state (Q3624078) → Location 계열 추가
   - Star 하위타입들 (Q5864 등) → Star 매핑 추가

2. **P279 계층 탐색 구현/수정**
   - P31 값이 직접 매핑에 없으면 P279 체인 탐색
   - 최대 탐색 깊이 제한 (예: 5단계)

3. **subtype_mappings 확장**
   - 더 많은 하위타입 → 상위타입 매핑 추가

### 11.4 우선순위

| 우선순위 | 타입 | 예상 영향 |
|----------|------|-----------|
| 1 | Country/State 매핑 | ~100만 개체 |
| 2 | Star 하위타입 매핑 | ~300만 개체 |
| 3 | Taxon 하위타입 매핑 | ~200만 개체 |
| 4 | P279 계층 탐색 | 전체 개선 |

---

*Generated by GEUL Entity SIDX Pipeline - Phase 6*
