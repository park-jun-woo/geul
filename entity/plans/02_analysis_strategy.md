# 59개 미완료 EntityType 48비트 스키마 설계를 위한 데이터 분석 전략

**작성일:** 2026-02-01
**역할:** Analyst
**상태:** Draft

---

## 1. 현황 분석

### 1.1 완료된 타입 (5개)

| 코드 | 타입명 | 개체수 | 스키마 상태 | 코드북 |
|------|--------|--------|-------------|--------|
| 0x00 | 인간 | 12,553,810 | 완료 | 완료 |
| 0x0C | 항성 | 3,634,978 | 완료 | 완료 |
| 0x1C | 정주지 | 580,084 | 완료 | 완료 |
| 0x2C | 조직 | 531,222 | 완료 | 완료 |
| 0x33 | 영화 | 335,651 | 완료 | 완료 |

### 1.2 미완료 타입 (59개)

Stage 1 속성 추출은 63개 타입에서 완료됨. 48비트 스키마 설계 및 코드북이 필요한 타입 59개.

---

## 2. 분석 우선순위 티어

### Tier 1: 즉시 분석 (100만+ 개체) - 8개

대용량 데이터로 충돌률 관리가 핵심. SIMD 최적화 필수.

| 코드 | 타입 | 개체수 | 범주 | Stage 1 샘플 | 핵심 속성 |
|------|------|--------|------|-------------|-----------|
| 0x01 | 생물종 | 3,787,844 | 생물 | 50,000 | taxon_rank, parent_taxon |
| 0x0D | 은하 | 2,133,383 | 천체 | 50,000 | constellation, redshift |
| 0x08 | 화학물질 | 1,278,857 | 물질 | 50,000 | subclass, chemical_formula |
| 0x02 | 유전자 | 1,225,271 | 생물 | 50,000 | found_in_taxon, chromosome |
| 0x09 | 화합물 | 1,061,080 | 물질 | 53* | **[주의] 샘플 부족** |
| 0x30 | 그림 | 1,060,257 | 창작물 | 50,000 | creator, genre, material |
| 0x03 | 단백질 | 1,014,021 | 생물 | 50,000 | found_in_taxon, molecular_function |
| 0x31 | 문서 | 45,000,000 | 창작물 | 50,000 | document_type, language |

**[REVIEW]** 0x09 화합물: 샘플 53개만 추출됨. Q11173 기준 재쿼리 필요.

### Tier 2: 높음 (10만-100만 개체) - 21개

| 코드 | 타입 | 개체수 | 범주 | Stage 1 샘플 |
|------|------|--------|------|-------------|
| 0x1F | 도로 | 710,621 | 장소 | 50,000 |
| 0x05 | 가문명 | 661,697 | 인물 | 50,000 |
| 0x14 | 산 | 518,080 | 지형 | 50,000 |
| 0x16 | 강 | 426,873 | 지형 | 50,000 |
| 0x32 | 문학작품 | 395,411 | 창작물 | 50,000 |
| 0x15 | 언덕 | 321,151 | 지형 | 50,000 |
| 0x34 | 앨범 | 303,243 | 창작물 | 50,000 |
| 0x20 | 묘지 | 298,046 | 장소 | 50,000 |
| 0x24 | 건물 | 291,961 | 건축물 | 50,000 |
| 0x39 | 특허 | 289,010 | 창작물 | 50,000 |
| 0x17 | 호수 | 292,152 | 지형 | 50,000 |
| 0x25 | 교회 | 286,141 | 건축물 | 50,000 |
| 0x0E | 소행성 | 248,597 | 천체 | 50,000 |
| 0x1D | 마을 | 245,116 | 장소 | 50,000 |
| 0x26 | 학교 | 242,467 | 건축물 | 50,000 |
| 0x27 | 주택 | 234,919 | 건축물 | 50,000 |
| 0x28 | 구조물 | 216,026 | 건축물 | 50,000 |
| 0x35 | 음악작품 | 194,833 | 창작물 | 50,000 |
| 0x18 | 시내 | 194,388 | 지형 | 50,000 |
| 0x3C | 스포츠시즌 | 183,463 | 이벤트 | 50,000 |
| 0x0F | 퀘이사 | 178,336 | 천체 | 50,000 |

### Tier 3: 보통 (1만-10만 개체) - 18개

| 코드 | 타입 | 개체수 | 범주 | Stage 1 샘플 |
|------|------|--------|------|-------------|
| 0x36 | TV에피소드 | 177,351 | 창작물 | 50,000 |
| 0x37 | 비디오게임 | 171,517 | 창작물 | 50,000 |
| 0x04 | 세포주 | 153,636 | 생물 | 50,000 |
| 0x19 | 섬 | 152,610 | 지형 | 50,000 |
| 0x1E | 소촌 | 148,250 | 장소 | 50,000 |
| 0x29 | 경기장 | 145,076 | 건축물 | 50,000 |
| 0x06 | 이름 | 128,000 | 인물 | 29,867 |
| 0x21 | 행정구역 | 100,000 | 장소 | 4,174* |
| 0x07 | 가상인물 | 98,000 | 인물 | 50,000 |
| 0x2F | 스포츠팀 | 95,000 | 조직 | 29,918 |
| 0x38 | TV시리즈 | 85,000 | 창작물 | 50,000 |
| 0x0A | 광물 | 62,000 | 물질 | 0** |
| 0x0B | 약물 | 45,000 | 물질 | 891* |
| 0x22 | 공원 | 45,000 | 장소 | 45,000 |
| 0x2A | 성 | 42,000 | 건축물 | 25,238 |
| 0x2B | 다리 | 38,000 | 건축물 | 32,701 |
| 0x23 | 보호구역 | 35,000 | 장소 | 35,000 |
| 0x2E | 정당 | 35,000 | 조직 | 22,950 |

**[REVIEW]** 0x21 행정구역: 샘플 4,174개. 0x0A 광물: 샘플 0개. 0x0B 약물: 샘플 891개.

### Tier 4: 낮음 (1만 미만 개체) - 12개

| 코드 | 타입 | 개체수 | 범주 | Stage 1 샘플 |
|------|------|--------|------|-------------|
| 0x10 | 행성 | 15,000 | 천체 | 12* |
| 0x3A | 소프트웨어 | 13,000 | 창작물 | 13,000 |
| 0x3B | 웹사이트 | 12,000 | 창작물 | 12,000 |
| 0x3E | 선거 | 11,000 | 이벤트 | 11,000 |
| 0x3D | 이벤트 | 10,000 | 이벤트 | 10,000 |
| 0x11 | 성운 | 8,000 | 천체 | 0** |
| 0x12 | 성단 | 5,000 | 천체 | 5,000 |
| 0x13 | 위성 | 3,000 | 천체 | 57* |
| 0x1A | 만 | 25,000 | 지형 | 25,000 |
| 0x1B | 동굴 | 20,000 | 지형 | 17,406 |
| 0x2D | 기업 | 241,620 | 조직 | 50,000 |

**[REVIEW]** 0x10 행성: 샘플 12개. 0x11 성운: 샘플 0개. 0x13 위성: 샘플 57개.

**참고:** 0x2D 기업은 개체수 24만이지만 0x2C 조직 스키마 재활용 가능.

---

## 3. 분석 전략

### 3.1 Stage 1 보완 쿼리 (즉시 실행 필요)

샘플이 부족하거나 없는 타입에 대한 재쿼리:

```sql
-- 샘플 부족 타입 목록
-- 0x09 화합물 Q11173: 53개
-- 0x0A 광물 Q7946: 0개
-- 0x0B 약물 Q12140: 891개
-- 0x10 행성 Q634: 12개
-- 0x11 성운 Q12057: 0개
-- 0x13 위성 Q2537: 57개
-- 0x21 행정구역 Q15284: 4,174개

-- 원인 분석: P31 = QID 직접 매칭 vs 하위 타입 포함 여부
-- 해결: P31/P279* 재귀 쿼리 또는 대체 QID 탐색
```

### 3.2 범주별 스키마 템플릿 전략

유사 범주 타입은 공통 스키마 템플릿 적용 후 미세 조정:

#### A. 생물 범주 (0x01-0x04)

| 필드 | 비트 | 설명 |
|------|-----|------|
| organism_group | 6 | 생물 계통 |
| taxon_rank | 4 | 분류 단계 |
| taxon_parent | 8 | 상위 분류 |
| geographic_origin | 6 | 지리적 기원 |
| common_attr | 24 | 타입별 특화 |

#### B. 천체 범주 (0x0D-0x13)

0x0C 항성 스키마 기반 확장:

| 필드 | 비트 | 설명 |
|------|-----|------|
| constellation | 7 | 별자리 88개 |
| ra_zone | 4 | 적경 구역 |
| dec_zone | 4 | 적위 구역 |
| magnitude | 4 | 겉보기등급 |
| type_specific | 29 | 타입별 특화 |

#### C. 지형 범주 (0x14-0x1B)

| 필드 | 비트 | 설명 |
|------|-----|------|
| country | 8 | 국가 |
| admin_region | 8 | 행정구역 |
| lat_zone | 4 | 위도 구역 |
| lon_zone | 4 | 경도 구역 |
| elevation | 5 | 고도 구간 |
| type_specific | 19 | 타입별 특화 |

#### D. 건축물 범주 (0x24-0x2B)

| 필드 | 비트 | 설명 |
|------|-----|------|
| country | 8 | 국가 |
| admin_region | 8 | 행정구역 |
| era | 4 | 건축 시대 |
| heritage | 4 | 문화재 등급 |
| building_type | 6 | 건물 유형 |
| type_specific | 18 | 타입별 특화 |

#### E. 창작물 범주 (0x30-0x3B)

0x33 영화 스키마 기반 확장:

| 필드 | 비트 | 설명 |
|------|-----|------|
| country | 8 | 제작국 |
| year | 7 | 연도 (1900+) |
| genre | 6 | 장르 |
| language | 8 | 언어 |
| medium | 4 | 매체 유형 |
| type_specific | 15 | 타입별 특화 |

### 3.3 속성 의존성 분석 쿼리

Stage 2 조건부 엔트로피 계산을 위한 쿼리 패턴:

```sql
-- 속성 쌍별 동시 출현 통계
WITH pair_stats AS (
    SELECT
        t1.property AS prop_a,
        t2.property AS prop_b,
        t1.object_value AS val_a,
        t2.object_value AS val_b,
        COUNT(*) AS cnt
    FROM triples t1
    JOIN triples t2 ON t1.subject = t2.subject
    WHERE t1.subject IN (
        SELECT subject FROM triples
        WHERE property = 'P31' AND object_value = '{QID}'
        LIMIT 10000
    )
    AND t1.property IN ({top_props})
    AND t2.property IN ({top_props})
    AND t1.property < t2.property
    GROUP BY t1.property, t2.property, t1.object_value, t2.object_value
)
SELECT * FROM pair_stats;

-- 조건부 엔트로피 H(B|A) 계산
-- Python에서 후처리
```

### 3.4 코드북 생성 전략

#### 3.4.1 독립 필드

- 빈도 기반 자동 할당
- 0x00 = Unknown/Unspecified
- 마지막 10% Reserved

#### 3.4.2 종속 필드 (부모 값별 테이블)

예: 국가 → 행정구역

```
country=KR: admin_code: 00=Unknown, 01=서울, 02=부산, ...
country=US: admin_code: 00=Unknown, 01=California, 02=Texas, ...
country=JP: admin_code: 00=Unknown, 01=Tokyo, 02=Osaka, ...
```

#### 3.4.3 LLM 검증 프롬프트 템플릿

```
다음은 {EntityType}의 {Field} 코드 테이블입니다.
누락된 중요한 값이 있거나, 순서가 부적절한 경우 지적해주세요.

코드 테이블:
{codebook}

검토 기준:
1. 상식적으로 자주 사용되는 값이 누락되지 않았는가?
2. 빈도 순서가 합리적인가?
3. 분류 체계가 상호 배타적인가?
```

---

## 4. 실행 계획

### Phase 1: 데이터 보완 (1-2일)

1. 샘플 부족 타입 재쿼리
2. QID 대체 후보 탐색 (P31 subclass 고려)
3. geulwork에 보완 데이터 저장

### Phase 2: Tier 1 분석 (3-5일)

1. 생물종, 은하, 화학물질 스키마 설계
2. 유전자, 단백질 공통 템플릿
3. 그림, 문서 창작물 템플릿

### Phase 3: Tier 2 분석 (5-7일)

1. 지형 범주 일괄 처리 (산, 강, 호수, 시내, 섬, 만, 동굴, 언덕)
2. 건축물 범주 일괄 처리 (건물, 교회, 학교, 주택, 구조물, 경기장, 성, 다리)
3. 장소 범주 (도로, 묘지, 마을, 소촌)

### Phase 4: Tier 3-4 분석 (3-5일)

1. 창작물 범주 확장
2. 이벤트 범주
3. 소규모 천체 타입

### Phase 5: 검증 (2-3일)

1. 전체 충돌률 테스트
2. 추상 표현 SIMD 쿼리 테스트
3. 코드북 LLM 검증

---

## 5. geulwork 저장 테이블 설계

```sql
-- 스키마 정의
CREATE TABLE entity_schema (
    type_code VARCHAR(4) PRIMARY KEY,  -- 0x00 ~ 0x3F
    type_name VARCHAR(50),
    schema_json JSONB,                 -- 48비트 필드 정의
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP
);

-- 코드북
CREATE TABLE entity_codebook (
    type_code VARCHAR(4),
    field_name VARCHAR(50),
    parent_code INT,                   -- 종속 필드용 부모 값
    code INT,
    value TEXT,
    qid TEXT,                          -- Wikidata QID (있는 경우)
    frequency BIGINT,
    PRIMARY KEY (type_code, field_name, parent_code, code)
);

-- 의존성 DAG
CREATE TABLE entity_dependency (
    type_code VARCHAR(4),
    parent_field VARCHAR(50),
    child_field VARCHAR(50),
    mutual_info FLOAT,
    conditional_entropy FLOAT,
    PRIMARY KEY (type_code, parent_field, child_field)
);

-- 충돌 통계
CREATE TABLE entity_collision_stats (
    type_code VARCHAR(4) PRIMARY KEY,
    total_entities BIGINT,
    unique_sidx BIGINT,
    collision_count BIGINT,
    collision_rate FLOAT,
    tested_at TIMESTAMP
);
```

---

## 6. 주요 리스크 및 완화책

| 리스크 | 확률 | 영향 | 완화책 |
|--------|------|------|--------|
| 샘플 부족 타입 데이터 추출 실패 | 중 | 고 | P279 재귀 쿼리, 대체 QID |
| 100만+ 타입 충돌률 초과 | 중 | 고 | 48비트 최적화, 주요 속성 우선 |
| 종속 필드 코드북 폭발 | 저 | 중 | 부모 값 군집화, 계층 축소 |
| LLM 검증 비용 | 저 | 저 | 배치 처리, Tier 1만 상세 검증 |

---

## 7. 즉시 실행 항목

### 7.1 Stage 1 보완 쿼리 실행

```bash
# 샘플 부족 타입 재처리
python scripts/stage1_run.py 0x09 0x0A 0x0B 0x10 0x11 0x13 0x21
```

### 7.2 Tier 1 스키마 초안 작성

다음 타입부터 48비트 스키마 설계 시작:
1. 0x01 생물종 (Taxon)
2. 0x0D 은하 (Galaxy)
3. 0x30 그림 (Painting)

---

## 변경 이력

| 버전 | 날짜 | 작성자 | 내용 |
|------|------|--------|------|
| v0.1 | 2026-02-01 | Analyst | 초안 작성 |
