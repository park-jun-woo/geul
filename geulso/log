# 1. 시스템 업데이트 및 필수 도구 설치
sudo apt update && sudo apt upgrade -y
sudo apt install python3-pip python3.12-venv -y

# 2. Ollama 설치
curl -fsSL https://ollama.com/install.sh | sh

# 3. 파이썬 가상환경 설정
mkdir ~/geul-project
cd ~/geul-project
python3 -m venv geul
source geul/bin/activate
echo 'source ~/ollama-project/geul/bin/activate' >> ~/.bashrc
ln -s {geul-gitrepo-path} ~/geul
echo 'cd ~/geul' >> ~/.bashrc
source ~/.bashrc

# 4. Ollama 파이썬 라이브러리 설치
pip install ollama
ollama pull gpt-oss:20b

# PostgreSQL 설치
sudo apt install postgresql -Y

# PostgreSQL 비밀번호 변경
psql -u postgres
postgres=# ALTER USER postgres PASSWORD 'test1224!';

# PostgreSQL 비밀번호 정책 설정
sudo vi /etc/postgresql/16/main/pg_hba.conf

# PostgreSQL 접속, 위키데이터/워드넷 테이블 및 인덱스 생성
psql -U postgres -d geuldev

# 위키데이터 PostgreSQL에 입력
pv ~/latest-all.json.bz2 | pbzip2 -dk -p28 > /mnt/d/latest-all.json
go run geulso/wikidata/postgres.go

# 워드넷 데이터 PostgreSQL에 입력
pip install psycopg2-binary tqdm
wget -P ~/ https://wordnetcode.princeton.edu/wn3.1.dict.tar.gz
tar -xzvf ~/wn3.1.dict.tar.gz -C ~/
python3 geulso/wordnet/postgres.py

# 워드넷 동사 의미소분해 Gemini 2.5 flash에게 수행
pip install -q -U google-genai
pip install psycopg2-binary tqdm
python3 geulso/factorize/factorize.py --skip-existing --concurrent 10
python3 geulso/factorize/update.py
# 오류 정정
python3 geulso/factorize/validate.py --skip-existing --concurrent 10
# 오류 정정 적용하기
python3 geulso/factorize/corrected.py

# 워드넷 동사 의미소분해 PostgreSQL에 입력
python3 geulso/factorize/postgres.py --clear

python3 geulso/factorize/find.py assistance.n.01
python3 geulso/factorize/verify_lemma.py experiencer refrainment

# 허깅페이스 CCNEWS PostgreSQL에 입력
pip install psycopg2-binary datasets tqdm
python3 geulso/ccnews/postgres.py
# 허깅페이스 CCNEWS 문장 단위로 분리
pip install psycopg2-binary nltk
python3 geulso/ccnews/sentences.python

# 허깅페이스 CCNEWS spaCy 처리
pip install cupy-cuda13x
pip install torch
pip install -U 'spacy[cuda12x]'
python -m spacy download en_core_web_trf
python3 geulso/ccnews/spacy_news.py

# 허깅페이스 CCNEWS spaCy gpt-oss:20b 검수
ollama pull gpt-oss:20b
pip install psycopg2-binary requests tqdm
python3 geulso/ccnews/review_spacy.py

# 위키데이터 쿼리 실행해서 JSON으로 저장
# 사용량 TOP1000 조회
go run geulso/wikidata/query.go --path "geulso/wikidata/usage_top1000.json" --query "SELECT
    stats.property_id,
    prop_meta.label_en AS property_label,
    stats.object_value,
    obj_label.label AS object_label,
    stats.usage_count
FROM property_object_stats AS stats
LEFT JOIN properties_meta AS prop_meta ON stats.property_id = prop_meta.property_id
LEFT JOIN entity_labels AS obj_label ON stats.object_value = obj_label.entity_id AND obj_label.language = 'en'
ORDER BY stats.usage_count DESC LIMIT 1000;"
# P17(country) 사용량 조회
go run geulso/wikidata/query.go --path "geulso/wikidata/country.json" --query "SELECT
    stats.property_id,
    prop_meta.label_en AS property_label,
    stats.object_value,
    obj_label.label AS object_label,
    stats.usage_count
FROM property_object_stats AS stats
LEFT JOIN properties_meta AS prop_meta ON stats.property_id = prop_meta.property_id
LEFT JOIN entity_labels AS obj_label ON stats.object_value = obj_label.entity_id AND obj_label.language = 'en'
WHERE stats.property_id='P17'
ORDER BY stats.usage_count DESC;"
# P407(language) 사용량 조회
go run geulso/wikidata/query.go --path "geulso/wikidata/language.json" --query "SELECT
    stats.property_id,
    prop_meta.label_en AS property_label,
    stats.object_value,
    obj_label.label AS object_label,
    stats.usage_count
FROM property_object_stats AS stats
LEFT JOIN properties_meta AS prop_meta ON stats.property_id = prop_meta.property_id
LEFT JOIN entity_labels AS obj_label ON stats.object_value = obj_label.entity_id AND obj_label.language = 'en'
WHERE stats.property_id='P407'
ORDER BY stats.usage_count DESC;"

# P31(instance of) 사용량 TOP1000 조회
go run geulso/wikidata/query.go --path "geulso/wikidata/instance_top1000.json" --query "SELECT
    stats.property_id,
    prop_meta.label_en AS property_label,
    stats.object_value,
    obj_label.label AS object_label,
    stats.usage_count
FROM property_object_stats AS stats
LEFT JOIN properties_meta AS prop_meta ON stats.property_id = prop_meta.property_id
LEFT JOIN entity_labels AS obj_label ON stats.object_value = obj_label.entity_id AND obj_label.language = 'en'
WHERE stats.property_id='P31'
ORDER BY stats.usage_count DESC LIMIT 1000;"

# SSHG 문장 분석
#python -c "import nltk; nltk.download('treebank')"
python3 sshg/sentence.py

pip install pydelphin pyyaml
python3 sshg/mrs.py --sentence "I saw the man with the telescope." --output sshg/output/i_saw_the_man.yaml
python3 sshg/mrs.py --sentence "Time flies like an arrow." --output sshg/output/time_flies.yaml


# 워드넷 동사 synset_id 갯수 세기
python3 geulso/wordnet/countv.py

# 워드넷 동사 의미소분해 결과 유효성 검사
python3 geulso/wordnet/valid_flat.py

# corrected에 JSON 전부 통합
python3 geulso/factorize/sync_json.py

# corrected에 JSON 의 구성이 유효한지 확인
python3 geulso/factorize/check.py

# 워드넷 동사 synset_id 상위어로 트리 만들기
python3 geulso/wordnet/verbtree.py

# 워드넷 동사 synset_id 상위어 목록 추출
python3 geulso/wordnet/verbtop559.py geulso/wordnet/verbtop559.json

# 워드넷 동사 synset_id 상위어 원하는 primitive 목록 추출
python3 geulso/wordnet/verbtop-primitive.py BE geulso/wordnet/top/verbtop-be.json
python3 geulso/wordnet/verbtop-primitive.py PERCEIVE geulso/wordnet/top/verbtop-perceive.json
python3 geulso/wordnet/verbtop-primitive.py FEEL geulso/wordnet/top/verbtop-feel.json
python3 geulso/wordnet/verbtop-primitive.py THINK geulso/wordnet/top/verbtop-think.json
python3 geulso/wordnet/verbtop-primitive.py CHANGE geulso/wordnet/top/verbtop-change.json
python3 geulso/wordnet/verbtop-primitive.py CAUSE geulso/wordnet/top/verbtop-cause.json
python3 geulso/wordnet/verbtop-primitive.py MOVE geulso/wordnet/top/verbtop-move.json
python3 geulso/wordnet/verbtop-primitive.py COMMUNICATE geulso/wordnet/top/verbtop-communicate.json
python3 geulso/wordnet/verbtop-primitive.py TRANSFER geulso/wordnet/top/verbtop-transfer.json
python3 geulso/wordnet/verbtop-primitive.py SOCIAL geulso/wordnet/top/verbtop-social.json

# 워드넷 최상위동사 559개의 하위 동사 트리 생성
python3 geulso/wordnet/verbtrees.py

# 워드넷 sub_primitive마다 동사 count하기
python3 geulso/wordnet/sub_primitive_count.py

# 워드넷 최상위동사 559개의 하위 동사 트리 비트 할당
python3 geulso/wordnet/verbtrees_bit.py

# 워드넷 최상위동사 559개의 하위 동사 트리 비트 유효성 검사
python3 geulso/wordnet/valid_verb_bits.py

# 위키데이터 분석 P31 목적어로 쓰인 Q-ID 간 P279(subclass of) 관계로 그래프 → 트리 변환
python3 geulso/wikidata/wikitrees1.py

# 위키데이터 TOP후보 목록 추출
python3 geulso/wikidata/topcandidate.py