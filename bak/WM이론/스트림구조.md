## 1. ID 체계

### 1) SIDX (Meaning ID, 64bit, 4워드)

* WMS의 **기본 ID**.
* 상위 56bit: 의미정렬 비트 (도메인/역할/세계선/시대/POV 등).
* 하위 8bit: 충돌 방지/여유.
* 사람/조직/장소/세계/컨텍스트/세계관(POV)… 전부 SIDX로 표현.
* 장점:

  * 대통령/사업가/지구667/특정 시대/특정 세계선 같은 걸 **비트마스크로 고속 필터** 가능.
  * WMS 검색은 전부 SIDX 기반으로 설계.

### 2) CTXSIDX (Context = 세계+시점+POV)

* Context도 결국 하나의 **개체 노드 SIDX**.
* 안에 논리적으로 포함되는 것:

  * `world_mid` : Earth-667 / Earth-616 / 현실 세계 …
  * `time/scene` : 연도, 타임라인 인덱스, 씬 번호
  * `pov_mid` : 개인 시점, 이념/세계관, 내레이터 POV
  * `modality` : REAL / MEMORY / BELIEF / WHAT_IF / PROPAGANDA …
* 모든 사실/엣지는 **“어떤 Context에서 참이냐”**를 CTXSIDX로 지정.

### 3) EID (Existence ID)

* 동일성(“이 사람은 이 사람이다”)을 위한 ID.
* 하나의 EID가 시간/역할에 따라 여러 SIDX 프로필(상태)을 가질 수 있음.
* 예: 머스크가 나중에 대통령이 되면 “대통령 상태 SIDX”를 새로 부여.

### 4) TID (Temporary ID, 16bit)

* **GEUL/GPT 입출력 전용 로컬 인덱스**.

* WMS 내부에는 저장하지 않음.

* 스트림 상단에 `TIDMAP`:

  ```geul
  0x0001 -> SIDX(아이언맨)
  0x0002 -> SIDX(지구667)
  0x0003 -> SIDX(CTX_지구667_2000_마블공식)
  ```

* 이후 Node/Edge는 모두 이 16bit TID로만 서로를 참조.

* TID는 그냥 **auto increment 번호표**로 충분 (의미정렬 불필요).

---

## 2. Node 설계

### 1) WMS 내부 규칙

* **모든 Node/Edge는 4워드(64bit) 고정**, 헤더 포함.

  * 구현 편의, SIMD/배열 정렬, 슬랩 할당 편함.

### 2) GEUL Stream 상 Node 헤더

* `Node/Edge` (1bit): 0 = 노드
* `Value/Object` (1bit):

  * 0 = 값 계열 (하지만 WMS에서는 따로 안 씀)
  * 1 = 개체(Object)
* `L-Payload` / `ObjectType` 등은 스트림용 스펙이고,
  WMS 내부에선 더 조밀하게 재패킹 가능.

### 3) Object Node (개체 노드)

* 사람, 장소, 조직, 작품, 사건, Context, POV, QuantitySpec 등 **모든 명사 계열**을 포함.
* Context도 **ObjectType의 한 종류**:

  * `ObjectType = CONTEXT` 라고 두고,
    페이로드에 world/time/pov/modality 등을 담아 해석.

### 4) QuantitySpec (물리량 스펙 노드)

* **“물리량”은 별도 노드 타입이 아니라, 개체의 한 종류**로 간다.
* 예: 길이, 시간, 질량, HP, 돈, 각도 등.
* 4워드 안에 담기는 내용:

  * 정수/부동, 부호 여부
  * 비트 폭(16/32/48/64 등 카테고리)
  * 단위(m, s, kg, HP, USD…)
  * 스케일(0.01 단위 같은 고정 소수)
  * 표시형식/범위 등.

---

## 3. Edge 설계

### 1) 기본 개념

* **Edge = (Context, Subject, Property, Object/Value)** 4축.
* WMS 내부에선 각 슬롯이 전부 **SIDX or 값 64bit**.
* Edge도 Node와 마찬가지로 **4워드 고정** (헤더+필드 재패킹으로 맞춤).

### 2) Edge 헤더 (16bit)

* `Node/Edge` (1bit): 1 = 엣지
* `Verb/Edge` (1bit): 0 = 동사(행위 의미), 1 = 구조/그래프 엣지
* `EdgeType` (14bit): 최대 16,383종 (Triple, Event6, KeyframeLink, Meta…)

  * 지금 단계에선 14bit면 충분, 2워드 헤더까지 갈 필요 없음.

### 3) Triple Edge

* Wikidata Triple ⇒ GEUL Triple Edge로 매핑:

  * **WMS 내부**:

    * `ctx_mid`   : CTXSIDX
    * `subj_mid`  : 개체 SIDX
    * `prop_id`   : 16~32bit Property ID
    * `obj_mid` 또는 `value64`
  * `keyframe_mid` 같은 건 Context/SIDX 쪽으로 흡수 (Context 축에서 해결).

### 4) Event Edge (6하원칙, 6항)

* 6W 사건 엣지:

  * who, what, whom, when, where, why (+ ctx_mid)
* 대통령 관련 사건처럼 **역할/세계선·시대 필터링**은 SIDX 비트마스크로 처리.

---

## 4. 시간/버전/Keyframe

### 1) Keyframe = 시점 상태

* 개별 엔티티의 상태가 특정 시점에서 어떻게 정의되는지.
* Keyframe 자체도 **노드(개체)**로 볼 수 있고,
  실제 쿼리는 대부분 CTXSIDX 기반으로 해결.

### 2) Timeline & Context

* “지구667의 2000년”, “지구667의 Scene_45”,
  “토니 머릿속 2000년 세계”, “기독교 세계관에서 본 2000년 현실”
  전부 Context로 통합:

  * world + time + pov + modality 조합 → 하나의 CTXSIDX.

---

## 5. 물리량 처리

### 1) 물리량 노드 삭제

* 스트림 스펙에 있던 “물리량 노드” 구분은 **WMS 레벨에선 제거**.
* 대신:

  > **QuantitySpec 개체 노드 + Edge의 value 슬롯** 조합으로 처리.

### 2) Property + QuantitySpec

* Property 메타 또는 Property가 가리키는 QuantitySpec을 통해:

  * 이 값의 단위, 타입, 스케일 등을 해석.
* Edge의 64bit value 슬롯은 **숫자 비트만** 채워 쓴다.
* 4워드 고정 유지하면서도 **64bit 값 표현** 가능.

---

## 6. TID / GEUL / GPT 연동

### 1) WMS 내부

* **항상 SIDX 64bit**:

  * `ctx_mid`, `subj_mid`, `obj_mid`, `prop_id`, `value64`.
* 대통령/세계관/역할/세계선/시대/POV 쿼리는
  전부 SIDX 비트마스크 + 인덱스/샤딩으로 고속 처리.

### 2) 경량 GEUL (GPT 입출력용)

* Meta Header의 `Length-Index = 00` → 인덱스 1워드 (16bit TID).
* 상단에 `TIDMAP`:

  * `TID -> SIDX` 매핑.
* 이후 Node/Edge 패킷들은:

  * 자기 TID + CTX TID + Subject TID + Property + Object TID …
    로 구성 (3항 Edge 기준 6워드 정도).
* **노드 + 엣지 개수가 65,536 이하**면 1워드 TID로 충분.
* WMS ↔ GPT 변환 시:

  * 쿼리 결과에서 등장한 SIDX들을 순차 scan하면서
    새 SIDX마다 TID auto increment 부여.

---

## 7. 전체 철학 요약

1. **의미/그래프/쿼리는 전부 WMS + SIDX 세계에서 해결.**

   * 64bit SIDX에 의미를 정렬해두고,
   * Context(세계+시점+POV)도 SIDX로,
   * 대통령·세계선·이념·시대·역할 필터링을 비트마스크로 처리.

2. **GPT/LLM은 GEUL 경량 스트림을 다룬다.**

   * TIDMAP + 1워드 TID로 압축된 그래프 스냅샷을 입력으로 받고,
   * 자연어 질의 ↔ GEUL 구조 쿼리 변환에 집중.

3. **Node/Edge는 WMS에서 4워드 고정.**

   * 헤더는 타입/플래그,
   * 슬롯은 SIDX/값,
   * 물리량은 QuantitySpec 노드 + 64bit value로 관리.

4. **복잡한 건 SIDX/Context/Property/QuantitySpec에 몰고,
   TID는 그냥 번호표로 단순하게.**

이 정도가 지금까지 우리가 같이 쌓아올린 WMS+GEUL 설계의 골격이야.
이 다음 단계에서 할 만한 건, 아마 **실제 Edge 레이아웃(비트단위) 확정**이랑,
**대표 쿼리 몇 개를 의사코드로 써보는 것** 정도일 거고.
