# WMS ë°ì´í„° íŒŒì¼ êµ¬ì¡° ëª…ì„¸ì„œ v1.0

**ë¬¸ì„œ ë²„ì „:** 1.0  
**ì‘ì„±ì¼:** 2024-12-03  
**ëŒ€ìƒ:** WMS ì½”ì–´ ì—”ì§„ ê°œë°œì

---

## ëª©ì°¨

1. [ê°œìš”](#1-ê°œìš”)
2. [íŒŒì¼ êµ¬ì¡° ì² í•™](#2-íŒŒì¼-êµ¬ì¡°-ì² í•™)
3. [2-Tier ì•„í‚¤í…ì²˜](#3-2-tier-ì•„í‚¤í…ì²˜)
4. [Snapshot íŒŒì¼ êµ¬ì¡°](#4-snapshot-íŒŒì¼-êµ¬ì¡°)
5. [Delta íŒŒì¼ êµ¬ì¡°](#5-delta-íŒŒì¼-êµ¬ì¡°)
6. [ì¿¼ë¦¬ ë° ë³‘í•© ì „ëµ](#6-ì¿¼ë¦¬-ë°-ë³‘í•©-ì „ëµ)
7. [ì»´íŒ©ì…˜ í”„ë¡œì„¸ìŠ¤](#7-ì»´íŒ©ì…˜-í”„ë¡œì„¸ìŠ¤)
8. [íŒŒì¼ í¬ë§· ìƒì„¸](#8-íŒŒì¼-í¬ë§·-ìƒì„¸)
9. [êµ¬í˜„ ê°€ì´ë“œ](#9-êµ¬í˜„-ê°€ì´ë“œ)

---

## 1. ê°œìš”

### 1.1 ì„¤ê³„ ëª©í‘œ

WMS ë°ì´í„° íŒŒì¼ì€ ë‹¤ìŒ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤:

1. **ê³ ì† ì½ê¸°**: mmap + SIMD ë¹„íŠ¸ë§ˆìŠ¤í¬ë¡œ ëŒ€ê·œëª¨ ìŠ¤ìº” ìµœì í™”
2. **íš¨ìœ¨ì  ì“°ê¸°**: ì¶”ê°€ ì „ìš©(append-only) ë¸íƒ€ë¡œ ì“°ê¸° ë³‘ëª© ì œê±°
3. **í™•ì¥ì„±**: Worldë³„ ë…ë¦½ íŒŒì¼ë¡œ ìˆ˜í‰ í™•ì¥
4. **ë²„ì „ ê´€ë¦¬**: ìŠ¤ëƒ…ìƒ· ê¸°ë°˜ ì‹œì  ë³µì›
5. **íˆ¬ëª…ì„±**: ë‹¨ìˆœí•˜ê³  ëª…í™•í•œ ë°”ì´ë„ˆë¦¬ í¬ë§·

### 1.2 World = íŒŒì¼

```
gwms_data/
â”œâ”€â”€ realworld_2024Q3.gwm          # ìœ„í‚¤ë°ì´í„° (ìŠ¤ëƒ…ìƒ·)
â”œâ”€â”€ realworld_delta_001.gwm       # ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
â”œâ”€â”€ realworld_delta_002.gwm       # ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
â”œâ”€â”€ mcu.gwm                       # ë§ˆë¸” ìœ ë‹ˆë²„ìŠ¤
â”œâ”€â”€ lotr.gwm                      # ë°˜ì§€ì˜ ì œì™•
â””â”€â”€ my_novel.gwm                  # ì‚¬ìš©ì ì‘í’ˆ
```

**ì›ì¹™:**
- 1 World = 1ê°œ ì´ìƒì˜ íŒŒì¼ (.gwm)
- ìŠ¤ëƒ…ìƒ· + Nê°œ ë¸íƒ€ ì¡°í•©ìœ¼ë¡œ ìµœì‹  ìƒíƒœ í‘œí˜„
- World ê°„ ê²©ë¦¬ (ë…ë¦½ ì‹¤í–‰, ì„ íƒì  ë‹¤ìš´ë¡œë“œ)

---

## 2. íŒŒì¼ êµ¬ì¡° ì² í•™

### 2.1 í•µì‹¬ ì›ì¹™

#### A) ì˜ë¯¸ì •ë ¬ ID (Semantic-Aligned ID)
```
SIDX êµ¬ì¡° (64-bit):
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1  â”‚   7    â”‚           56             â”‚
â”‚Flagâ”‚Categoryâ”‚         Index            â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Flag (1bit):
- 0 = Static (Snapshot)
- 1 = Dynamic (Delta)

Category (7bit):
- 0x00 = PERSON
- 0x01 = ORG
- 0x02 = PLACE
- 0x03 = WORK
- ...
- 0x7F = RESERVED
```

#### B) Structure of Arrays (SoA)
```
âŒ Array of Structures (AoS):
[{mid, flags, name}, {mid, flags, name}, ...]
â†’ ìºì‹œ ë¹„íš¨ìœ¨, SIMD ë¶ˆê°€

âœ… Structure of Arrays (SoA):
SIDXs:   [mid1, mid2, mid3, ...]
Flags:  [f1,   f2,   f3,   ...]
Names:  [n1,   n2,   n3,   ...]
â†’ ì—°ì† ë©”ëª¨ë¦¬, SIMD ìµœì í™”
```

#### C) mmap ì¹œí™”ì 
```
- 4KB í˜ì´ì§€ ì •ë ¬
- 2MB Huge Page ì§€ì›
- OS í˜ì´ì§€ ìºì‹œ í™œìš©
- Zero-copy ì ‘ê·¼
```

### 2.2 íŒŒì¼ í¬ê¸° ì˜ˆìƒ

```
RealWorld (ìœ„í‚¤ë°ì´í„° 1ì–µ ì—”í‹°í‹°):
â”œâ”€ Entity Region: ~5GB
â”œâ”€ Edge Region: ~30GB
â”œâ”€ Index Region: ~8GB
â””â”€ ì´ ~43GB (ì••ì¶• ì „)
   ì••ì¶• í›„: ~25GB

FictionWorld (ì†Œì„¤ 1ë§Œ ì—”í‹°í‹°):
â”œâ”€ Entity Region: ~10MB
â”œâ”€ Edge Region: ~50MB
â””â”€ ì´ ~60MB
```

---

## 3. 2-Tier ì•„í‚¤í…ì²˜

### 3.1 Tier êµ¬ë¶„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Tier 1: Snapshot (Immutable)      â”‚
â”‚   - ì½ê¸° ì „ìš©                        â”‚
â”‚   - ì£¼ê¸°ì  ì¬ìƒì„± (ë¶„ê¸°ë³„)           â”‚
â”‚   - mmap + SIMD ìµœì í™”               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“ ë³‘í•©
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Tier 2: Delta (Mutable)           â”‚
â”‚   - ì¶”ê°€ ì „ìš© (append-only)          â”‚
â”‚   - ì‹¤ì‹œê°„ ì“°ê¸°                      â”‚
â”‚   - ì„ê³„ê°’ ë„ë‹¬ ì‹œ ì»´íŒ©ì…˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ì¿¼ë¦¬ íë¦„

```
Query("íŠ¹ì • ì¡°ê±´ì˜ ì—”í‹°í‹°"):
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Snapshot ìŠ¤ìº” â”‚ â†’ SIMD ë¹„íŠ¸ë§ˆìŠ¤í¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Delta ìŠ¤ìº”    â”‚ â†’ ì„ í˜• ìŠ¤ìº” (ì‘ìŒ)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Merge        â”‚ â†’ Tombstone ì²˜ë¦¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
       ê²°ê³¼
```

### 3.3 ì“°ê¸° íë¦„

```
Insert/Update/Delete:
  â†“
Delta íŒŒì¼ì— Append
  â†“
Delta í¬ê¸° ì²´í¬
  â†“
ì„ê³„ê°’ ì´ˆê³¼? â†’ ë°±ê·¸ë¼ìš´ë“œ ì»´íŒ©ì…˜
```

---

## 4. Snapshot íŒŒì¼ êµ¬ì¡°

### 4.1 ì „ì²´ ë ˆì´ì•„ì›ƒ

```
world_2024Q3.gwm (ë‹¨ì¼ íŒŒì¼)

[0x0000] Header (4KB)
â”œâ”€ Magic: "WMS" (4 bytes)
â”œâ”€ Version: uint32
â”œâ”€ Tier: SNAPSHOT
â”œâ”€ WorldId: uint64
â”œâ”€ Created: timestamp
â”œâ”€ Endian: 0x01 (Little)
â”œâ”€ Alignment: 4KB
â”œâ”€ Flags: uint32
â”œâ”€ Entity Count: uint64
â”œâ”€ Edge Count: uint64
â””â”€ Section Offsets[16]: uint64[]
    â”œâ”€ [0] = Header End (0x1000)
    â”œâ”€ [1] = Entity Region
    â”œâ”€ [2] = Edge Region
    â”œâ”€ [3] = Index Region
    â”œâ”€ [4] = Metadata
    â””â”€ [5-15] = Reserved

[0x1000] Entity Region
â”œâ”€ Bucket Directory (1MB)
â””â”€ Entity Buckets (SoA)

[Offset 2] Edge Region
â”œâ”€ Store Directory (1MB)
â””â”€ Edge Stores (SoA)

[Offset 3] Index Region
â”œâ”€ Hot SIDX Index
â”œâ”€ Composite Context Index
â””â”€ Timeline Index

[Offset 4] Metadata
â”œâ”€ World Description
â”œâ”€ Data Sources
â””â”€ Statistics
```

### 4.2 Entity Region

#### Bucket Directory
```
Offset: Section[1]
Size: 1MB (ê³ ì •)

struct BucketMetadata {
    Category    uint8      // 0x00 = PERSON
    Flags       uint8      // SORTED, COMPRESSED
    Reserved    uint16
    
    Offset      uint64     // ë²„í‚· ì‹œì‘ ì˜¤í”„ì…‹
    Count       uint64     // ì—”í‹°í‹° ê°œìˆ˜
    Capacity    uint64     // í• ë‹¹ í¬ê¸°
    
    // SoA ì»¬ëŸ¼ ì˜¤í”„ì…‹
    SIDXsOffset      uint64
    FlagsOffset     uint64
    DataOffset      uint64
    StringOffset    uint64
}

BucketMetadata[256]  // 256ê°œ ìŠ¬ë¡¯ (ì¹´í…Œê³ ë¦¬ë³„)
```

#### Bucket ë‚´ë¶€ (SoA ì˜ˆì‹œ: PERSON)
```
Bucket 0x00: PERSON
â”œâ”€ SIDXs: [uint64 Ã— count]
â”‚  â””â”€ ì •ë ¬ë¨ (ì´ì§„ ê²€ìƒ‰ ê°€ëŠ¥)
â”‚
â”œâ”€ Flags: [uint32 Ã— count]
â”‚  â”œâ”€ bit[0-7]: ìƒíƒœ í”Œë˜ê·¸
â”‚  â”œâ”€ bit[8-15]: ì—­í•  í”Œë˜ê·¸
â”‚  â””â”€ bit[16-31]: Reserved
â”‚
â”œâ”€ BirthYear: [int32 Ã— count]
â”‚
â”œâ”€ DeathYear: [int32 Ã— count]
â”‚
â””â”€ NameOffsets: [uint32 Ã— count]
   â””â”€ String Pool ì°¸ì¡°
```

**ì••ì¶• ì˜µì…˜:**
```
Delta Encoding (SIDX):
ì›ë³¸: [0x01, 0x02, 0x03, ...]
ì••ì¶•: Base=0x01, Deltas=[0, 1, 2, ...]
â†’ 8ë°° ì••ì¶• (uint64 â†’ uint8)

ì ìš© ì¡°ê±´:
- ë²„í‚· ë‚´ SIDXê°€ ì—°ì†ì ì¼ ë•Œ
- Flags.COMPRESSED = 1
```

### 4.3 Edge Region

#### Store Directory
```
Offset: Section[2]
Size: 1MB (ê³ ì •)

struct StoreMetadata {
    StoreType   uint16     // TRIPLE, EVENT6, ...
    Flags       uint16
    
    Offset      uint64     // Store ì‹œì‘ ì˜¤í”„ì…‹
    Count       uint64     // ì—£ì§€ ê°œìˆ˜
    
    // íŒŒí‹°ì…˜ ì •ë³´ (ì˜µì…˜)
    PartitionType  uint8   // NONE, TIME, PROP
    PartitionKey   uint64  // íŒŒí‹°ì…˜ í‚¤
    
    // SoA ì»¬ëŸ¼ ì˜¤í”„ì…‹
    CtxOffset       uint64
    SubjOffset      uint64
    PropOffset      uint64
    ObjOffset       uint64
}

StoreMetadata[256]  // ì—¬ëŸ¬ Store ì§€ì›
```

#### TripleStore (SoA)
```
TripleStore
â”œâ”€ Ctx:  [uint64 Ã— count]
â”œâ”€ Subj: [uint64 Ã— count]
â”œâ”€ Prop: [uint32 Ã— count]
â””â”€ Obj:  [uint64 Ã— count]

íŒŒí‹°ì…”ë‹ ì˜µì…˜:
1. By Property Group
   â”œâ”€ TripleStore_Relation
   â”œâ”€ TripleStore_Attribute
   â””â”€ TripleStore_Membership

2. By Time Shard
   â”œâ”€ TripleStore_1900s
   â”œâ”€ TripleStore_2000s
   â””â”€ TripleStore_2020s

ì„ íƒ ê¸°ì¤€: ì¿¼ë¦¬ íŒ¨í„´ì— ë”°ë¼
```

#### Event6Store (SoA)
```
Event6Store
â”œâ”€ Ctx:      [uint64 Ã— count]
â”œâ”€ Who:      [uint64 Ã— count]
â”œâ”€ What:     [uint64 Ã— count]
â”œâ”€ Whom:     [uint64 Ã— count]
â”œâ”€ When:     [uint64 Ã— count]
â”œâ”€ Where:    [uint64 Ã— count]
â”œâ”€ Why:      [uint64 Ã— count]
â””â”€ Presence: [uint8 Ã— count]
   â””â”€ ë¹„íŠ¸ë§ˆìŠ¤í¬ (6ê°œ í•„ë“œ ì¡´ì¬ ì—¬ë¶€)
      bit[0]: Who
      bit[1]: What
      bit[2]: Whom
      bit[3]: When
      bit[4]: Where
      bit[5]: Why
```

### 4.4 Index Region

#### Hot SIDX Index (ì„ íƒì )
```
ìš©ë„: ìì£¼ ì¡°íšŒë˜ëŠ” SIDX ë¹ ë¥¸ ì ‘ê·¼

êµ¬ì¡°: Hash Table
â”œâ”€ Buckets: 64K (2^16)
â”œâ”€ Entry: (SIDX, BucketId, LocalOffset)
â””â”€ Size: ~10MB (1ë§Œ ê°œ ê¸°ì¤€)

í¬í•¨ ëŒ€ìƒ:
âœ… World SIDX (ìˆ˜ë°±)
âœ… Context SIDX (ìˆ˜ë§Œ)
âœ… ì£¼ìš” ìºë¦­í„° (ì‘í’ˆë‹¹ ìˆ˜ì‹­)
âŒ ì¼ë°˜ ì—”í‹°í‹° (ë²„í‚· ìŠ¤ìº”)
```

#### Composite Context Index
```
ìš©ë„: (World, POV, Modality, Time) ë³µí•© ì¿¼ë¦¬

êµ¬ì¡°:
Key: (WorldId, POV, Modality, TimeRange)
Value: [CtxId range]

Physical Layout (B-Tree):
â”œâ”€ Root
â”‚  â””â”€ Keys: [(W1,*,*,1900-2000), ...]
â”‚
â””â”€ Leaves
   â””â”€ (W1, POV1, REAL, 1990-2000)
      â†’ [0x...100, 0x...150]  // 50ê°œ CTX
```

#### Timeline Index
```
ìš©ë„: ì‹œê°„ ë²”ìœ„ ì¿¼ë¦¬

êµ¬ì¡°: Year Bucket Array
â”œâ”€ [1900] â†’ EventList offset
â”œâ”€ [1901] â†’ EventList offset
â”œâ”€ ...
â””â”€ [2024] â†’ EventList offset

EventList:
[EventSIDX1, EventSIDX2, ...]

ì¿¼ë¦¬:
"1990-2000ë…„ ì´ë²¤íŠ¸"
â†’ Year[1990:2000] ìˆœì°¨ ì½ê¸°
â†’ ì—°ì† ë©”ëª¨ë¦¬ ì ‘ê·¼
```

### 4.5 Metadata Section
```
â”œâ”€ World Description
â”‚  â”œâ”€ Name: string
â”‚  â”œâ”€ Type: REAL / FICTION
â”‚  â””â”€ Description: string
â”‚
â”œâ”€ Data Sources
â”‚  â”œâ”€ based_on: "Wikidata 2024-03-15"
â”‚  â”œâ”€ ingest_pipeline: "v1.2.3"
â”‚  â”œâ”€ model_version: "SLT v2.1"
â”‚  â””â”€ created_at: timestamp
â”‚
â””â”€ Statistics
   â”œâ”€ Entity Count by Category
   â”œâ”€ Edge Count by Type
   â”œâ”€ Timeline Coverage
   â””â”€ Compression Ratio
```

---

## 5. Delta íŒŒì¼ êµ¬ì¡°

### 5.1 ì „ì²´ ë ˆì´ì•„ì›ƒ

```
world_delta_001.gwm (ì¶”ê°€ ì „ìš©)

[0x0000] Header (4KB)
â”œâ”€ Magic: "WMS"
â”œâ”€ Version: uint32
â”œâ”€ Tier: DELTA
â”œâ”€ WorldId: uint64
â”œâ”€ BaseSnapshot: "world_2024Q3.gwm"
â”œâ”€ Created: timestamp
â”œâ”€ Sequence: 1
â””â”€ Record Count: uint64

[0x1000] Record Stream (append-only)
â”œâ”€ Record 1
â”œâ”€ Record 2
â”œâ”€ ...
â””â”€ Record N
```

### 5.2 Record êµ¬ì¡°

```
struct Record {
    Type     uint8      // INSERT, UPDATE, DELETE
    Size     uint32     // ë ˆì½”ë“œ í¬ê¸°
    SIDX      uint64     // ëŒ€ìƒ SIDX
    Data     []byte     // ê°€ë³€ ê¸¸ì´ ë°ì´í„°
    CRC32    uint32     // ì²´í¬ì„¬
}

Type:
- 0x01 = INSERT_ENTITY
- 0x02 = INSERT_EDGE
- 0x03 = UPDATE_ENTITY
- 0x04 = UPDATE_EDGE
- 0x05 = DELETE_ENTITY (Tombstone)
- 0x06 = DELETE_EDGE (Tombstone)
```

### 5.3 Tombstone (ì‚­ì œ ë§ˆì»¤)

```
DELETE_ENTITY Record:
â”œâ”€ Type: 0x05
â”œâ”€ SIDX: 0x0100000042
â””â”€ Data: null

ì¿¼ë¦¬ ì‹œ:
1. Snapshotì—ì„œ SIDX ë°œê²¬
2. Deltaì—ì„œ Tombstone ë°œê²¬
3. â†’ ê²°ê³¼ì—ì„œ ì œì™¸
```

---

## 6. ì¿¼ë¦¬ ë° ë³‘í•© ì „ëµ

### 6.1 Entity ì¡°íšŒ

```go
func (w *World) GetEntity(mid SIDX) (*Entity, error) {
    // 1. Hot Cache ì²´í¬
    if cached := w.hotCache.Get(mid); cached != nil {
        return cached, nil
    }
    
    // 2. Delta ìŠ¤ìº” (ì—­ìˆœ)
    for i := len(w.deltas) - 1; i >= 0; i-- {
        if record := w.deltas[i].Find(mid); record != nil {
            if record.Type == DELETE_ENTITY {
                return nil, ErrNotFound  // Tombstone
            }
            return record.ToEntity(), nil
        }
    }
    
    // 3. Snapshot ê²€ìƒ‰
    category := (mid >> 56) & 0x7F
    bucket := w.snapshot.buckets[category]
    
    // ë²„í‚· ë‚´ ì´ì§„ ê²€ìƒ‰
    idx := sort.Search(bucket.Count, func(i int) bool {
        return bucket.SIDXs[i] >= mid
    })
    
    if idx >= bucket.Count || bucket.SIDXs[idx] != mid {
        return nil, ErrNotFound
    }
    
    // SoAì—ì„œ ë°ì´í„° ì¡°í•©
    entity := &Entity{
        SIDX:   mid,
        Flags: bucket.Flags[idx],
        Name:  w.stringPool.Get(bucket.NameOffsets[idx]),
    }
    
    // Hot Cacheì— ì¶”ê°€
    w.hotCache.Add(mid, entity)
    
    return entity, nil
}
```

### 6.2 ë²”ìœ„ ì¿¼ë¦¬ (SIMD)

```go
func (w *World) QueryEntities(filter Filter) []SIDX {
    results := []SIDX{}
    
    // 1. Snapshot SIMD ìŠ¤ìº”
    for _, bucket := range w.snapshot.buckets {
        if !filter.CategoryMatch(bucket.Category) {
            continue  // ì¹´í…Œê³ ë¦¬ ë¶ˆì¼ì¹˜, ë²„í‚· ì „ì²´ ìŠ¤í‚µ
        }
        
        // SIMD ë¹„íŠ¸ë§ˆìŠ¤í¬ í•„í„°
        candidates := simd.Filter(
            bucket.SIDXs,
            filter.Mask,
            filter.Pattern,
        )
        
        results = append(results, candidates...)
    }
    
    // 2. Delta ì¶”ê°€ ìŠ¤ìº”
    for _, delta := range w.deltas {
        for _, record := range delta.records {
            if filter.Match(record.SIDX) {
                if record.Type == DELETE_ENTITY {
                    results = remove(results, record.SIDX)
                } else {
                    results = append(results, record.SIDX)
                }
            }
        }
    }
    
    // 3. ì¤‘ë³µ ì œê±° + ì •ë ¬
    return deduplicate(results)
}
```

### 6.3 N-hop íƒìƒ‰

```go
func (w *World) Hop(start []SIDX, maxHops int, edgeFilter EdgeFilter) []SIDX {
    visited := make(map[SIDX]bool)
    current := start
    
    for hop := 0; hop < maxHops; hop++ {
        next := []SIDX{}
        
        for _, mid := range current {
            if visited[mid] {
                continue
            }
            visited[mid] = true
            
            // Snapshot Edge ìŠ¤ìº”
            edges := w.snapshot.GetEdgesFrom(mid, edgeFilter)
            
            // Delta Edge ìŠ¤ìº”
            deltaEdges := w.getDeltaEdges(mid, edgeFilter)
            
            // ë³‘í•©
            allEdges := merge(edges, deltaEdges)
            
            for _, edge := range allEdges {
                next = append(next, edge.Object)
            }
        }
        
        current = next
    }
    
    return keys(visited)
}
```

---

## 7. ì»´íŒ©ì…˜ í”„ë¡œì„¸ìŠ¤

### 7.1 íŠ¸ë¦¬ê±° ì¡°ê±´

```
Compaction ì‹œì‘ ì¡°ê±´:
1. Delta íŒŒì¼ í¬ê¸° í•© > 1GB
2. Delta íŒŒì¼ ê°œìˆ˜ > 10ê°œ
3. Tombstone ë¹„ìœ¨ > 20%
4. ìˆ˜ë™ íŠ¸ë¦¬ê±° (ê´€ë¦¬ì)
5. ìŠ¤ì¼€ì¤„ (ë§¤ì¼ 03:00)
```

### 7.2 í”„ë¡œì„¸ìŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Prepare                          â”‚
â”‚ - Delta íŒŒì¼ë“¤ ì •ë ¬                  â”‚
â”‚ - Snapshot ë¡œë“œ                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Merge                            â”‚
â”‚ - Snapshot + Deltas ë³‘í•©             â”‚
â”‚ - Tombstone ì²˜ë¦¬                     â”‚
â”‚ - ì¤‘ë³µ ì œê±°                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Write New Snapshot               â”‚
â”‚ - ìƒˆ íŒŒì¼ ìƒì„±                       â”‚
â”‚ - SoA ë ˆì´ì•„ì›ƒ                       â”‚
â”‚ - ì••ì¶•/ìµœì í™”                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Atomic Swap                      â”‚
â”‚ - ì‹¬ë³¼ë¦­ ë§í¬ êµì²´                   â”‚
â”‚ - ë˜ëŠ” ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Cleanup                          â”‚
â”‚ - êµ¬ Snapshot ë°±ì—…                   â”‚
â”‚ - Delta íŒŒì¼ ì‚­ì œ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 êµ¬í˜„ ì˜ˆì‹œ

```go
func (w *World) Compact() error {
    // 1. ìƒˆ ì„ì‹œ íŒŒì¼ ìƒì„±
    newSnapshot := CreateTempSnapshot()
    
    // 2. ëª¨ë“  Entity ë³‘í•©
    for category := 0; category < 128; category++ {
        // Snapshot ë²„í‚·
        oldBucket := w.snapshot.buckets[category]
        
        // Delta ë ˆì½”ë“œ
        deltaRecords := w.collectDeltaRecords(category)
        
        // ë³‘í•©
        merged := mergeBucket(oldBucket, deltaRecords)
        
        // ìƒˆ íŒŒì¼ì— ì“°ê¸°
        newSnapshot.WriteBucket(category, merged)
    }
    
    // 3. ëª¨ë“  Edge ë³‘í•©
    for storeType := range w.snapshot.edgeStores {
        oldStore := w.snapshot.edgeStores[storeType]
        deltaEdges := w.collectDeltaEdges(storeType)
        
        merged := mergeStore(oldStore, deltaEdges)
        newSnapshot.WriteStore(storeType, merged)
    }
    
    // 4. ì¸ë±ìŠ¤ ì¬êµ¬ì¶•
    newSnapshot.RebuildIndexes()
    
    // 5. Finalize
    newSnapshot.WriteMetadata()
    newSnapshot.Sync()
    
    // 6. Atomic Swap
    newPath := fmt.Sprintf("world_%s.gwm", time.Now().Format("2006Q1"))
    os.Rename(newSnapshot.Path, newPath)
    
    // 7. êµ¬ íŒŒì¼ ì •ë¦¬
    w.snapshot.Close()
    for _, delta := range w.deltas {
        os.Remove(delta.Path)
    }
    
    // 8. ìƒˆ íŒŒì¼ ë¡œë“œ
    w.snapshot = OpenSnapshot(newPath)
    w.deltas = []Delta{}
    
    return nil
}
```

---

## 8. íŒŒì¼ í¬ë§· ìƒì„¸

### 8.1 ë°”ì´ë„ˆë¦¬ ì¸ì½”ë”©

```
Endianness: Little Endian (x86-64 ê¸°ë³¸)

ê¸°ë³¸ íƒ€ì…:
- uint8:  1 byte
- uint16: 2 bytes
- uint32: 4 bytes
- uint64: 8 bytes
- int32:  4 bytes (2's complement)
- int64:  8 bytes (2's complement)

String:
â”œâ”€ Length: uint32 (4 bytes)
â””â”€ Data:   []byte (ê°€ë³€)

Array:
â”œâ”€ Count:  uint64 (8 bytes)
â””â”€ Items:  [T Ã— count]
```

### 8.2 ì •ë ¬ ê·œì¹™

```
Section ì •ë ¬: 4KB (0x1000)
Large Section: 2MB (0x200000) - Huge Page

ì˜ˆì‹œ:
Header:        0x0000 - 0x0FFF (4KB)
Entity Region: 0x1000 - 0xXXXX (4KB ì •ë ¬)
Edge Region:   0xYYYY - 0xZZZZ (2MB ì •ë ¬)
```

### 8.3 ì••ì¶• ì˜µì…˜

```
ì§€ì› ì•Œê³ ë¦¬ì¦˜:
1. Delta Encoding (SIDX, ì •ìˆ˜)
2. Run-Length Encoding (í”Œë˜ê·¸)
3. zstd (String Pool)

Flags:
- Bucket.Flags.COMPRESSED (0x01)
- Bucket.Flags.DELTA_ENCODED (0x02)
```

### 8.4 ì²´í¬ì„¬

```
ì „ì—­ ì²´í¬ì„¬:
Header.CRC32: ì „ì²´ íŒŒì¼ (Header ì œì™¸)

ì„¹ì…˜ë³„ ì²´í¬ì„¬:
BucketMetadata.CRC32: í•´ë‹¹ ë²„í‚·
StoreMetadata.CRC32: í•´ë‹¹ Store

Delta Record:
Record.CRC32: ë ˆì½”ë“œ ë°ì´í„°
```

---

## 9. êµ¬í˜„ ê°€ì´ë“œ

### 9.1 Phase 1: Snapshot ê¸°ë³¸ (Month 1-2)

**ëª©í‘œ:** ì½ê¸° ì „ìš© Snapshot íŒŒì¼ ìƒì„±/ë¡œë“œ

```
TODO:
â–¡ Header êµ¬ì¡°ì²´ ì •ì˜
â–¡ Entity Bucket SoA ë ˆì´ì•„ì›ƒ
â–¡ TripleStore SoA ë ˆì´ì•„ì›ƒ
â–¡ mmap ê¸°ë°˜ íŒŒì¼ ë¡œë“œ
â–¡ ë²„í‚· ë‚´ ì´ì§„ ê²€ìƒ‰
â–¡ ê¸°ë³¸ ì¿¼ë¦¬ (GetEntity, GetEdge)
â–¡ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (100ë§Œ ì—”í‹°í‹°)
```

### 9.2 Phase 2: Delta ì§€ì› (Month 3-4)

**ëª©í‘œ:** ì‹¤ì‹œê°„ ì“°ê¸° ì§€ì›

```
TODO:
â–¡ Delta íŒŒì¼ í¬ë§· ì •ì˜
â–¡ Append-only ì“°ê¸°
â–¡ Snapshot + Delta ë³‘í•© ì¿¼ë¦¬
â–¡ Tombstone ì²˜ë¦¬
â–¡ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì‚½ì…/ì‚­ì œ)
```

### 9.3 Phase 3: Compaction (Month 5-6)

**ëª©í‘œ:** ë°±ê·¸ë¼ìš´ë“œ ì••ì¶•

```
TODO:
â–¡ ì»´íŒ©ì…˜ íŠ¸ë¦¬ê±° ë¡œì§
â–¡ ë³‘í•© ì•Œê³ ë¦¬ì¦˜
â–¡ Atomic Swap
â–¡ ì—ëŸ¬ ë³µêµ¬ (ë¡¤ë°±)
â–¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (1ì–µ ì—”í‹°í‹°)
```

### 9.4 Phase 4: ìµœì í™” (Month 7+)

```
TODO:
â–¡ Hot SIDX Cache
â–¡ SIMD ë¹„íŠ¸ë§ˆìŠ¤í¬ ìµœì í™”
â–¡ Edge Store íŒŒí‹°ì…”ë‹
â–¡ Composite Context Index
â–¡ ì••ì¶• ì•Œê³ ë¦¬ì¦˜ ì ìš©
```

### 9.5 íŒŒì¼ í¬ê¸° ì œí•œ

```
ê¶Œì¥ ê°’:
- Snapshot: < 100GB (ë‹¨ì¼ íŒŒì¼)
- Delta: < 1GB (ê°œë³„ íŒŒì¼)
- Hot Cache: 100MB (ë©”ëª¨ë¦¬)

ì´ˆê³¼ ì‹œ:
- Snapshot: World ë¶„í•  ê³ ë ¤
- Delta: ì¦‰ì‹œ ì»´íŒ©ì…˜
```

### 9.6 ì—ëŸ¬ ì²˜ë¦¬

```
íŒŒì¼ ì†ìƒ ê°ì§€:
1. Header CRC ì²´í¬
2. Section CRC ì²´í¬
3. Magic Number ê²€ì¦

ë³µêµ¬ ì „ëµ:
1. ìµœê·¼ ë°±ì—… Snapshot ì‚¬ìš©
2. Delta ì¬ì ìš©
3. ì†ìƒ ì„¹ì…˜ ìŠ¤í‚µ (ë¶€ë¶„ ë³µêµ¬)

ë¡œê¹…:
- ëª¨ë“  ì»´íŒ©ì…˜ ì‘ì—… ë¡œê·¸
- Delta ì“°ê¸° ë¡œê·¸
- ì—ëŸ¬ ìƒì„¸ ìŠ¤íƒ
```

---

## ë¶€ë¡ A: íŒŒì¼ í—¤ë” ìƒì„¸

```c
// Header (256 bytes, í™•ì¥ ê°€ëŠ¥)
struct WMSHeader {
    // Identification
    uint8_t  magic[4];           // "WMS"
    uint32_t version;            // 0x00010000 (v1.0)
    uint8_t  tier;               // 0=SNAPSHOT, 1=DELTA
    uint8_t  endian;             // 0x01=Little
    uint16_t alignment;          // 4096 (4KB)
    
    // World Info
    uint64_t world_id;           // World SIDX
    uint64_t created;            // Unix timestamp
    uint64_t modified;           // Unix timestamp
    
    // Statistics
    uint64_t entity_count;
    uint64_t edge_count;
    uint64_t context_count;
    
    // Offsets (8 bytes each)
    uint64_t entity_region_offset;
    uint64_t edge_region_offset;
    uint64_t index_region_offset;
    uint64_t metadata_offset;
    uint64_t reserved[12];
    
    // Integrity
    uint32_t header_crc;         // Header CRC (ì´ í•„ë“œ ì œì™¸)
    uint32_t file_crc;           // ì „ì²´ íŒŒì¼ CRC
    
    // Padding to 256 bytes
    uint8_t padding[88];
};
```

---

## ë¶€ë¡ B: íƒ€ì… ì •ì˜

```go
// core/types.go

package core

// SIDX (Meaning ID) - 64-bit semantic-aligned identifier
type SIDX uint64

const (
    SIDX_FLAG_MASK     = 0x8000000000000000
    SIDX_CATEGORY_MASK = 0x7F00000000000000
    SIDX_INDEX_MASK    = 0x00FFFFFFFFFFFFFF
)

func (m SIDX) IsStatic() bool {
    return (m & SIDX_FLAG_MASK) == 0
}

func (m SIDX) Category() uint8 {
    return uint8((m & SIDX_CATEGORY_MASK) >> 56)
}

func (m SIDX) Index() uint64 {
    return uint64(m & SIDX_INDEX_MASK)
}

// Categories
const (
    CAT_PERSON      = 0x00
    CAT_ORG         = 0x01
    CAT_PLACE       = 0x02
    CAT_WORK        = 0x03
    CAT_EVENT       = 0x04
    CAT_CONTEXT     = 0x05
    CAT_QUANTITY    = 0x06
    CAT_RESERVED    = 0x7F
)

// WorldId, CtxId, EntityIdëŠ” ëª¨ë‘ SIDX
type WorldId = SIDX
type CtxId = SIDX
type EntityId = SIDX
type EdgeId = uint64  // EdgeëŠ” ë³„ë„ ID ì²´ê³„

// Tier
type Tier uint8

const (
    TIER_SNAPSHOT Tier = 0
    TIER_DELTA    Tier = 1
)
```

---

## ë¶€ë¡ C: ì¿¼ë¦¬ DSL ì˜ˆì‹œ

### JSON DSL
```json
{
  "query_type": "entities",
  "world_id": "0x0500000001",
  "filters": {
    "category": "PERSON",
    "roles": ["PRESIDENT", "SCIENTIST"],
    "time_range": {
      "start": "1990-01-01",
      "end": "2000-12-31"
    }
  },
  "limit": 100,
  "score_by": "Importance_SLT"
}
```

### Go API
```go
// ê°„ë‹¨í•œ ì¡°íšŒ
person := world.GetEntity(0x0100000042)

// í•„í„° ì¿¼ë¦¬
presidents := world.Query().
    Category(CAT_PERSON).
    Role("PRESIDENT").
    TimeRange("1990-01-01", "2000-12-31").
    Limit(100).
    Execute()

// N-hop íƒìƒ‰
friends := world.Traverse().
    Start(alice_mid).
    Follow(FRIEND_EDGE).
    Hops(3).
    Filter(func(mid SIDX) bool {
        return mid.Category() == CAT_PERSON
    }).
    Execute()
```

---

## ë¶€ë¡ D: ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ëª©í‘œ

### ì½ê¸° ì„±ëŠ¥ (Snapshot)
```
í™˜ê²½: AMD Ryzen 9 / 64GB RAM / NVMe SSD

GetEntity (Hot Cache):
- ëª©í‘œ: < 0.1 Î¼s
- ë°©ë²•: LRU ìºì‹œ

GetEntity (Bucket Binary Search):
- ëª©í‘œ: < 10 Î¼s
- ë°©ë²•: mmap + ì´ì§„ ê²€ìƒ‰

Range Query (SIMD):
- ë°ì´í„°: 1ì–µ ì—”í‹°í‹°
- ì¡°ê±´: ì¹´í…Œê³ ë¦¬ + ì—­í•  í•„í„°
- ëª©í‘œ: < 100 ms
- ë°©ë²•: AVX2 ë¹„íŠ¸ë§ˆìŠ¤í¬

N-hop Traversal (3-hop):
- ì‹œì‘: 100ê°œ ë…¸ë“œ
- ê²°ê³¼: 10,000ê°œ ë…¸ë“œ
- ëª©í‘œ: < 50 ms
- ë°©ë²•: CSR ì¸ë±ìŠ¤ + ì—°ì† ë©”ëª¨ë¦¬
```

### ì“°ê¸° ì„±ëŠ¥ (Delta)
```
Insert Entity:
- ëª©í‘œ: < 1 ms
- ë°©ë²•: Append-only

Insert Edge:
- ëª©í‘œ: < 1 ms
- ë°©ë²•: Append-only

Batch Insert (10,000 entities):
- ëª©í‘œ: < 100 ms
- ë°©ë²•: ë°°ì¹˜ ì“°ê¸°
```

### ì»´íŒ©ì…˜ ì„±ëŠ¥
```
ë°ì´í„°:
- Snapshot: 1ì–µ ì—”í‹°í‹°
- Delta: 1,000ë§Œ ì¶”ê°€/ìˆ˜ì •

ëª©í‘œ:
- ì‹œê°„: < 10ë¶„
- ë‹¤ìš´íƒ€ì„: 0 (ì½ê¸° ê³„ì† ê°€ëŠ¥)
- ë©”ëª¨ë¦¬: < 10GB
```

---

## ë¶€ë¡ E: ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

### v1.0 â†’ v1.1 (ê°€ìƒ ì‹œë‚˜ë¦¬ì˜¤)

```
ë³€ê²½ì‚¬í•­:
- Entity Bucketì— "Tags" í•„ë“œ ì¶”ê°€
- Edge Storeì— "Weight" í•„ë“œ ì¶”ê°€

ë§ˆì´ê·¸ë ˆì´ì…˜ ì ˆì°¨:
1. êµ¬ ë²„ì „ íŒŒì¼ ì—´ê¸° (read-only)
2. ìƒˆ ë²„ì „ íŒŒì¼ ìƒì„±
3. Entity ë³µì‚¬ + Tags í•„ë“œ ì¶”ê°€ (ê¸°ë³¸ê°’: null)
4. Edge ë³µì‚¬ + Weight í•„ë“œ ì¶”ê°€ (ê¸°ë³¸ê°’: 1.0)
5. ì¸ë±ìŠ¤ ì¬êµ¬ì¶•
6. ê²€ì¦
7. Atomic Swap

ë¡¤ë°±:
- êµ¬ íŒŒì¼ ë³´ê´€ (30ì¼)
- ë¬¸ì œ ë°œìƒ ì‹œ ì¦‰ì‹œ ë¡¤ë°±
```

---

## ë¶€ë¡ F: íŒŒì¼ ê²€ì¦ ë„êµ¬

### gwms-verify ëª…ë ¹ì–´
```bash
# íŒŒì¼ ë¬´ê²°ì„± ê²€ì¦
$ gwms-verify world_2024Q3.gwm

Checking world_2024Q3.gwm...
âœ“ Magic number: OK
âœ“ Version: 1.0
âœ“ Header CRC: OK
âœ“ Entity Region: OK (100M entities)
âœ“ Edge Region: OK (1B edges)
âœ“ Index Region: OK
âœ“ File CRC: OK

Summary:
- File size: 43.2 GB
- Entities: 100,000,000
- Edges: 1,000,000,000
- Compression: 42%
- Status: HEALTHY

# Delta ì²´ì¸ ê²€ì¦
$ gwms-verify --chain world_2024Q3.gwm

Verifying snapshot + delta chain...
âœ“ world_2024Q3.gwm (base)
âœ“ world_delta_001.gwm (120K records)
âœ“ world_delta_002.gwm (95K records)

Chain status: OK
Total records: 215,000
Tombstones: 12% (recommend compaction)
```

---

## ë¶€ë¡ G: ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: Snapshot (MVP)
```
Week 1-2: ê¸°ë³¸ êµ¬ì¡°
â–¡ Header êµ¬ì¡°ì²´ (header.go)
â–¡ Bucket êµ¬ì¡°ì²´ (bucket.go)
â–¡ Store êµ¬ì¡°ì²´ (store.go)
â–¡ mmap ë˜í¼ (mmap.go)

Week 3-4: Entity Region
â–¡ Bucket Directory ì½ê¸°/ì“°ê¸°
â–¡ SoA ë ˆì´ì•„ì›ƒ êµ¬í˜„
â–¡ ì´ì§„ ê²€ìƒ‰ êµ¬í˜„
â–¡ í…ŒìŠ¤íŠ¸ (100K entities)

Week 5-6: Edge Region
â–¡ Store Directory ì½ê¸°/ì“°ê¸°
â–¡ TripleStore SoA êµ¬í˜„
â–¡ Event6Store SoA êµ¬í˜„
â–¡ í…ŒìŠ¤íŠ¸ (1M edges)

Week 7-8: í†µí•© í…ŒìŠ¤íŠ¸
â–¡ ì „ì²´ íŒŒì¼ ìƒì„±/ë¡œë“œ
â–¡ GetEntity ë²¤ì¹˜ë§ˆí¬
â–¡ Range Query êµ¬í˜„
â–¡ ì„±ëŠ¥ ê²€ì¦ (10M entities)
```

### Phase 2: Delta
```
Week 9-10: Delta íŒŒì¼
â–¡ Delta Header êµ¬ì¡°
â–¡ Record ì¸ì½”ë”©/ë””ì½”ë”©
â–¡ Append êµ¬í˜„
â–¡ í…ŒìŠ¤íŠ¸

Week 11-12: ë³‘í•© ë¡œì§
â–¡ Snapshot + Delta ë³‘í•©
â–¡ Tombstone ì²˜ë¦¬
â–¡ ì¤‘ë³µ ì œê±°
â–¡ í…ŒìŠ¤íŠ¸
```

### Phase 3: Compaction
```
Week 13-14: ê¸°ë³¸ ì»´íŒ©ì…˜
â–¡ íŠ¸ë¦¬ê±° ì¡°ê±´
â–¡ ë³‘í•© ì•Œê³ ë¦¬ì¦˜
â–¡ ì„ì‹œ íŒŒì¼ ìƒì„±
â–¡ í…ŒìŠ¤íŠ¸

Week 15-16: Atomic Swap
â–¡ ì‹¬ë³¼ë¦­ ë§í¬ ì „ëµ
â–¡ ë¡¤ë°± ë©”ì»¤ë‹ˆì¦˜
â–¡ ì—ëŸ¬ ì²˜ë¦¬
â–¡ í†µí•© í…ŒìŠ¤íŠ¸
```

---

## ë¶€ë¡ H: ì°¸ê³  ìë£Œ

### ìœ ì‚¬ ì‹œìŠ¤í…œ ë²¤ì¹˜ë§ˆí‚¹
```
RocksDB (LSM-Tree):
- Snapshot (SST íŒŒì¼) + MemTable
- Compaction ì „ëµ
- ì°¸ê³ : Level Compaction

Parquet (ì»¬ëŸ¼í˜• ì €ì¥):
- SoA ë ˆì´ì•„ì›ƒ
- ì••ì¶• ê¸°ë²•
- ì°¸ê³ : Row Group ì„¤ê³„

HDF5 (ê³„ì¸µí˜• ë°ì´í„°):
- mmap í™œìš©
- ì²­í¬ ë‹¨ìœ„ ì ‘ê·¼
- ì°¸ê³ : Dataset êµ¬ì¡°
```

### ì½ì–´ë³¼ ë…¼ë¬¸
```
1. "The Log-Structured Merge-Tree (LSM-Tree)"
   - P. O'Neil et al., 1996
   - LSM ê¸°ë³¸ ê°œë…

2. "Dremel: Interactive Analysis of Web-Scale Datasets"
   - Google, 2010
   - ì»¬ëŸ¼í˜• ì €ì¥ì†Œ ì„¤ê³„

3. "C-Store: A Column-oriented DBMS"
   - MIT, 2005
   - SoA ìµœì í™” ê¸°ë²•
```

---

## ë¶€ë¡ I: FAQ

### Q1: World íŒŒì¼ì´ ë„ˆë¬´ í¬ë©´?
```
A: Shard ì „ëµ
- ì‹œê°„ë³„: world_1900s.gwm, world_2000s.gwm
- ì§€ì—­ë³„: world_asia.gwm, world_europe.gwm
- ì¿¼ë¦¬ ì‹œ ì—¬ëŸ¬ íŒŒì¼ ë³‘í•©
```

### Q2: Deltaê°€ ê³„ì† ìŒ“ì´ë©´?
```
A: ìë™ ì»´íŒ©ì…˜
- ì„ê³„ê°’ ì„¤ì • (ì˜ˆ: 1GB, 10ê°œ)
- ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…
- ë‹¤ìš´íƒ€ì„ 0
```

### Q3: íŒŒì¼ ì†ìƒ ì‹œ ë³µêµ¬ëŠ”?
```
A: ê³„ì¸µì  ë°±ì—…
- Snapshot: ë¶„ê¸°ë³„ ë³´ê´€
- Delta: ì‹¤ì‹œê°„ ë³µì œ
- ì†ìƒ ì„¹ì…˜ ìŠ¤í‚µ ê°€ëŠ¥
```

### Q4: Cross-World ì°¸ì¡°ëŠ”?
```
A: ExternalRef
- (WorldId, SIDX) íŠœí”Œ
- ëŸ°íƒ€ì„ ë¡œë“œ
- ì˜µì…˜: ê¸€ë¡œë²Œ ì¸ë±ìŠ¤
```

### Q5: ë™ì‹œ ì“°ê¸° ì§€ì›ì€?
```
A: Phase 4 (í–¥í›„)
- Delta íŒŒì¼ ë½
- Copy-on-Write
- ë˜ëŠ” ì¤‘ì•™ ì“°ê¸° ì„œë²„
```

---

## ë¶€ë¡ J: ë²„ì „ íˆìŠ¤í† ë¦¬

```
v1.0 (2024-12-03)
- ì´ˆê¸° ëª…ì„¸
- Snapshot + Delta êµ¬ì¡°
- 2-Tier ì•„í‚¤í…ì²˜

v1.1 (ê³„íš)
- Hot SIDX Cache
- Composite Context Index
- Edge Store íŒŒí‹°ì…”ë‹

v2.0 (ê³„íš)
- ë¶„ì‚° ì¿¼ë¦¬ ì§€ì›
- ì‹¤ì‹œê°„ ë³µì œ
- íŠ¸ëœì­ì…˜ ACID
```

---

## ê²°ë¡ 

### í•µì‹¬ ì„¤ê³„ ì›ì¹™ ìš”ì•½

1. **World = íŒŒì¼(ë“¤)**
   - 1ê°œ Snapshot + Nê°œ Delta
   - ë…ë¦½ì„±, ë²„ì „ ê´€ë¦¬, ë°°í¬ ìš©ì´

2. **SoA + mmap**
   - ì—°ì† ë©”ëª¨ë¦¬ = SIMD ìµœì í™”
   - OS í˜ì´ì§€ ìºì‹œ í™œìš©

3. **2-Tier ì•„í‚¤í…ì²˜**
   - Snapshot (ì½ê¸° ìµœì í™”)
   - Delta (ì“°ê¸° ìµœì í™”)
   - ì»´íŒ©ì…˜ìœ¼ë¡œ í†µí•©

4. **ì˜ë¯¸ì •ë ¬ ID**
   - SIDX ìƒìœ„ ë¹„íŠ¸ = ë¬¼ë¦¬ ë ˆì´ì•„ì›ƒ
   - ë¹„íŠ¸ë§ˆìŠ¤í¬ í•„í„° ê°€ëŠ¥

5. **ì ì§„ì  êµ¬í˜„**
   - Phase 1: Snapshot (MVP)
   - Phase 2: Delta
   - Phase 3: Compaction
   - Phase 4: ìµœì í™”

### ë‹¤ìŒ ë‹¨ê³„

```
â–¡ ì´ ëª…ì„¸ì„œ ë¦¬ë·°
â–¡ Go êµ¬ì¡°ì²´ ì •ì˜
â–¡ mmap ë˜í¼ êµ¬í˜„
â–¡ ì²« Snapshot íŒŒì¼ ìƒì„±
â–¡ ìœ„í‚¤ë°ì´í„° 1ë§Œ ê°œ ì„í¬íŠ¸
â–¡ ë²¤ì¹˜ë§ˆí¬
```

**ì´ ëª…ì„¸ì„œë¡œ WMS ì½”ì–´ êµ¬í˜„ì„ ì‹œì‘í•˜ì„¸ìš”! ğŸš€**

---

**ë¬¸ì„œ ë**
