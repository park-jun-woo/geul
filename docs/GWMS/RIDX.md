RIDX 설계 정리서

(Ruled Index / Rule-driven Index)

1. RIDX란 무엇인가?

정의 한 줄

> RIDX = “룰(또는 고비용 분석)에 의해 생성된, 월드 전역에 대한 특수 인덱스”



일반 MID 인덱스
→ “기본 의미좌표(성별, 종, 국가…)”로 빠르게 후보군을 줄이는 저수준 인덱스

RIDX
→ “천천히 하락하다가 급등한 주식”, “군견 적합 종”, “특정 성향의 인물”처럼
고차원 패턴/규칙에 의해 만들어진 고수준 인덱스


즉, 뉴럴 + 정교한 수학/규칙으로 한 번 비싸게 계산해둔 결과를,
GWMS에서 싸고 빠르게 재활용하기 위한 캐시 + 인덱스 레이어다.


---

2. 왜 필요한가?

2.1 MID만으로는 힘든 패턴들

예시:

“천천히 하락하다가 급등한 주식”

“군견으로 쓰기 적합한 견종”

“장기적으로 우울감이 악화되는 등장인물”

“진행형 → 완료 → 결과 상태로 이어지는 사건 패턴”


이런 것들은:

단일 시점의 속성으로는 안 잡힘
(→ 타임라인, 연속 데이터, 복합 패턴 필요)

사전에 태깅 / 분석을 해두지 않으면
질의 시점에 즉석으로 계산하기 너무 비쌈.


그래서:

> 한 번은 비싸게 **“패턴 탐지 + 태깅”**을 하고,
그 결과를 RIDX로 굽는다 → 그 다음부터는 싸게 조회.




---

3. 개념 구조

RIDX는 크게 이렇게 본다:

1. RIDX 정의 (메타데이터)

이 RIDX가 무엇을 의미하는지, 어떤 Rule/모델로 만들었는지



2. RIDX 엔트리 (실제 인덱스)

어떤 MID들이 이 인덱스에 속하는지

가중치/점수/부가 정보




3.1 RIDX 메타 구조 (개념 스키마)

RIDX
- ridx_id          // RIDX 고유 ID
- name             // 사람이 알아볼 이름
- description      // 자연어 설명
- world_id         // 어느 월드에 속하는가
- rule_ref         // 어떤 Rule / 파이프라인으로 만들어졌는가
- created_at
- updated_at
- status           // ACTIVE / STALE / ARCHIVED
- cost_tag         // 생성 비용 / 유지 비용 레벨 (LOW/MID/HIGH)

3.2 RIDX 엔트리 구조

RIDX_ENTRY
- ridx_id          // 어느 RIDX의 엔트리인가
- mid              // 대상 노드 MID
- score            // 패턴 적합도 (0.0 ~ 1.0)
- meta             // 옵션 (예: 검출 시점, 기간, 참고 값 등)

GWMS 내부에서는 결국:

RIDX = 하나의 그래프 서브뷰

RIDX_ENTRY = (RIDX) —[HAS_MEMBER, score=x]→ (MID) 엣지 집합


으로 볼 수 있음.


---

4. 언제 RIDX를 만든다?

4.1 트리거 정책

RIDX는 막 찍어내면 폭발하니까, 생성 조건이 필요하다:

1. 사용자 정의

“이 패턴 자주 쓴다. RIDX로 만들어라.”

예: 글월에서 “내 작품에서 자주 쓰는 캐릭터 패턴” 별도 인덱스



2. 쿼리 패턴 누적

동일/유사 질의가 N회 이상 반복

예: “지난 3년간 천천히 떨어졌다가 급등한 종목” → 많이 나오면 RIDX 생성 후보



3. 운영 정책

엔터프라이즈 환경에서 관리자/DBA가 직접 설계





---

5. 생성·갱신·삭제 라이프사이클

5.1 생성 (Build)

1. 룰/파이프라인 정의

예:

Rule: “가격 시퀀스에서 SLOW_DROP → SPIKE 패턴”

파이프라인: 수치 분석 + (옵션) 뉴럴 헬퍼




2. 전수 스캔 or 제한 스캔

대상: 특정 타입(주식, 견종, 인물 등)의 모든 노드

패턴 매칭 수행

패턴 적합하면 (ridx_id, mid, score) 등록



3. RIDX 활성화

status = ACTIVE

쿼리 플래너가 사용할 수 있게 등록




5.2 갱신 (Refresh)

월드가 변하면 RIDX도 낡는다:

주식 가격 갱신

인물 관계/성향 변화

뉴스/서술 추가


정책:

Full rebuild: 통으로 다시 계산 (비싸지만 쉬움)

Incremental update: 변경된 범위만 재계산 (복잡하지만 효율적)


RIDX 메타에:

valid_until 또는 staleness_score를 둬서
쿼리 플래너가 “좀 낡았으니 조심해라” 판단 가능하게.


5.3 아카이브 / 제거

RIDX도 무한정 쌓이면 안 되니:

사용량이 적은 RIDX → ARCHIVED 상태로 내려서

인덱스 엔트리 파일로 덤프

GWMS 메모리/핵심 인덱스에서는 제거


나중에 다시 필요해지면

아카이브에서 읽어와 재등록 or 다시 빌드



즉:

> “대부분의 질문은 빠르지만,
어떤 타입의 질문은 ‘아카이브 복원 + 재계산’ 때문에 10~20분 걸릴 수 있다.”



를 시스템 디자인 수준에서 수용.


---

6. 쿼리 플래너와의 관계

쿼리 플래너가 어떤 순서로 RIDX를 활용하냐가 관건.

6.1 기본 전략

1. 먼저 RIDX 후보 조회

사용자가 물어보는 패턴이

등록된 RIDX와 매칭되면
→ 바로 RIDX_ENTRY에서 MID 집합을 가져오기




2. RIDX 없음 → Plan B

기존 MID 인덱스 + 심볼릭 필터로 최대한 좁히고

그래도 안 되면 뉴럴 + 수학 파이프라인 발동

이때, “이 질의 패턴은 RIDX 생성 후보”로 등록 가능




6.2 예시 – 군견 적합 종 탐색

쿼리: “군견으로 적합한 견종 추천”


플래너:

1. RIDX_DOG_MILITARY_SUITABILITY 존재?

YES → 엔트리에서 상위 N종 뽑고 끝.

NO →

1. MID 인덱스로 개(犬) 종만 필터


2. 각 종의 본능/체력/지능/복종성 등 수치로 수학적 점수 계산


3. (옵션) 과거 뉴스/사용 레코드에 대한 뉴럴 분석 추가


4. 이 결과로 RIDX 생성 or 캐시만 유지







---

7. 뉴럴 연산과 RIDX

RIDX 철학의 핵심 중 하나가 이거였지:

> “비싼 신경망 연산은 1번만, 그 결과는 RIDX로 굽는다.”



7.1 RIDX가 뉴럴 의존도를 낮추는 방식

최초 질의/배치 작업 시:

큰 모델 or 비싼 파이프라인 사용

뉴럴 + 수학 + 룰로 “패턴 검출/분류/점수화”


이후:

같은 종류의 질의는
→ 뉴럴 안 쓰고 RIDX 조회만으로 해결



즉:

뉴럴 = 부트스트랩 + 태깅용

실전 쿼리 = 심볼릭 + RIDX + MID 기반 연산


으로 구조가 고정됨.


---

8. 예시들

8.1 “서서히 떨어지다 급등한 주식”

RIDX ID: RIDX_STOCK_SLOW_DROP_THEN_SPIKE

Rule:

일정 기간 이동평균 하락 추세

급등 구간에서 순간 변동률 ≥ T


초기 계산:

모든 종목의 가격 시계열 분석 (비쌈)


이후:

해당 패턴 찾는 질의는
→ RIDX_STOCK_SLOW_DROP_THEN_SPIKE에서만 조회



8.2 “헤비 월드 작가용 설정 접근”

대규모 판타지 월드, 수천 캐릭터, 수만 이벤트

RIDX 예:

RIDX_CHAR_LONG_TERM_GRUDGE (장기간 원한 유지)

RIDX_EVENT_MAJOR_PLOT_POINT

RIDX_CONTEXT_POLITICAL_CRISIS


작가는:

“이 세계에서 오랫동안 원한 품고 있는 인물만 보고 싶다”

→ 해당 RIDX에서 바로 꺼내면 됨


정합성 검사도:

“중요 플롯 포인트 주변 캐릭터 관계, 연령, 이동 경로 검증”

→ RIDX + 타임라인 인덱스 조합




---

9. 요약

RIDX의 역할을 한 문장씩 요약하면:

1. 정의

룰/파이프라인/뉴럴 분석으로 생성된 고차원 의미 인덱스



2. 목적

비싼 연산을 1회로 줄이고, 그 결과를 재활용하기 위함



3. 위치

GWMS의 MID(기본 인덱스) 위에 올라가는 2차 인덱스 레이어



4. 철학

“신경망은 가능한 한 덜 쓰고, 썼다면 반드시 저장해서 다시 안 쓰게 만든다.”



5. 운영

생성/갱신/아카이브 주기를 정책으로 관리

쿼리 플래너가 RIDX 우선, 실패 시 기존 경로 + RIDX 생성 후보 등록

