# **GEUL 스트림 포맷**

이 문서는 **글오(GEUL-O)**를 바이너리 데이터로 직렬화(serialization)하기 위한 표준 물리적 스트림 포맷을 정의합니다.

## 1. 핵심 설계 원칙

### 1.1 전역 정규화 및 단일 양자화 상태

**GEUL 스트림** 내의 모든 수치 값(메타데이터 포함)은 **-1.0에서 +1.0 사이로 정규화**됩니다. 이는 신경망 모델의 수치적 안정성을 보장하고 학습 효율을 극대화하기 위함입니다.

또한, 스트림 전체는 **단일 양자화 상태**를 가집니다. 예를 들어,

- **INT8 양자화 상태**라면, `Object Index`, `Packet Count`, `H`, `B` 등 모든 필드가 각각 8비트 정수로 표현됩니다.
- **FP16 상태**라면 모든 필드가 16비트 부동소수점으로 표현됩니다.

이 설계는 전체 데이터 덩어리(blob)를 GPU 메모리에 직접 로드하여 CPU의 개입 없이 즉시 병렬 처리할 수 있도록 하여, AI 연산 효율을 극대화합니다.

## 2. 계층 구조

**GEUL 스트림**은 **프레임(Frame) > 패킷(Packet) > 페이로드(Payload)**의 3단계 계층 구조를 가집니다.

---

## 3. 프레임 명세 (Frame Specification)

프레임은 하나의 **글오(GEUL-O)** 전체를 정의합니다. 모든 필드의 물리적 타입은 스트림의 양자화 상태에 따라 결정됩니다.

- `FE` **(Frame Start):** 1-element 시작 마커.
- `Object Index`**:** 글오(GEUL-O)의 고유 ID. 고유 ID(예: 64비트)를 표현하기 위해 **여러 element로 구성된 벡터**로 표현됩니다. (예: INT8 상태에서는 8개의 8비트 정수 벡터)
- `Packet Count`**:** 해당 글오(GEUL-O)에 포함된 총 패킷의 개수.
- `FD` **(Frame End):** 1-element 종료 마커.

---

## 4. 패킷 명세 (Packet Specification)

패킷은 프레임 내부에 위치하며, **글오(GEUL-O)**를 구성하는 실질적인 데이터 단위입니다. 이 개별 패킷 단위를 **글소(GEUL-SO)**라고 부를 수 있습니다.

- `FC` **(Packet Start):** 1-element 시작 마커.
- `Packet Index`**:** 글오(GEUL-O) 내에서 패킷의 순서를 나타내는 식별자.
- `Payload`**:** 아래 4.1절에서 설명하는 실제 데이터 페이로드입니다.
- `FB` **(Packet End):** 1-element 종료 마커.

### 4.1 페이로드 명세 (Payload Specification)

- `HL` **(Header Length):** 헤더(`H`)의 element 개수.
- `H` **(Header):** `HL`개의 element로 구성된 벡터. 데이터의 종류를 정의하는 의미소(Sememe) ID를 표현합니다.
- `BL` **(Body Length):** 바디(`B`)의 element 개수.
- `B` **(Body):** `BL`개의 element로 구성된 벡터. 헤더가 정의한 실제 데이터를 담습니다.

---

## 5. 스트림 예시 (INT8 양자화)

다음은 ID가 77번인 '스마트 사과' **글오(GEUL-O)**가 5개의 패킷을 포함하고, INT8로 양자화된 경우의 스트림 예시입니다. (리틀 엔디안 기준)

### 5.1 전체 스트림 (Hex)

`FE 4D 00 00 00 00 00 00 00 05 00 00 00 FC 00 00 00 00 01 00 10 01 00 F0 FB FC 01 00 00 00 01 00 21 01 00 8A FB FC 02 00 00 00 01 00 30 01 00 A0 FB FC 03 00 00 00 01 00 31 01 00 60 FB FC 04 00 00 00 01 00 40 01 00 FF FB FD`

### 5.2 구조 분석

| Offset | Hex 값 | 필드 | 설명 |
| --- | --- | --- | --- |
| `0x00` | `FE` | **Frame Start** | 글오(GEUL-O) 시작 |
| `0x01-08` | `4D 00 ... 00` | **Object Index** | 64비트 정수 `77` |
| `0x09-0C` | `05 00 00 00` | **Packet Count** | 32비트 정수 `5` (패킷 5개) |
|  |  |  | **--- 패킷 0 (글소: Species) ---** |
| `0x0D` | `FC` | **Packet Start** |  |
| `0x0E-11` | `00 00 00 00` | **Packet Index** | `0` |
| `0x12-13` | `01 00` | **HL** | 헤더 길이 `1` |
| `0x14` | `10` | **H** | 헤더 값: `16` (종) |
| `0x15-16` | `01 00` | **BL** | 바디 길이 `1` |
| `0x17` | `F0` | **B** | 바디 값: `240` (사과, `+0.88`) |
| `0x18` | `FB` | **Packet End** |  |
|  |  |  | **--- 패킷 1 (글소: Color.Hue) ---** |
| `0x19` | `FC` | **Packet Start** |  |
| `0x1A-1D` | `01 00 00 00` | **Packet Index** | `1` |
| `0x1E-1F` | `01 00` | **HL** | 헤더 길이 `1` |
| `0x20` | `21` | **H** | 헤더 값: `33` (색상) |
| `0x21-22` | `01 00` | **BL** | 바디 길이 `1` |
| `0x23` | `8A` | **B** | 바디 값: `138` (붉은색, `+0.09`) |
| `0x24` | `FB` | **Packet End** |  |
| `...` | `...` | `...` | **... (패킷 2, 3, 4 반복) ...** |
| `...` | `FD` | **Frame End** | 글오(GEUL-O) 종료 |